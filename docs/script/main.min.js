!function(){"use strict";var e={852:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;var o=r(753),l=r(62),u=r(61),s=a(r(586)),c=r(513),d=function(){function e(){var e=this;this.fullscreenVBO=l.VBO.createQuad(o.gl,-1,-1,1,1),(0,c.asyncLoadShader)("heightmap","fullscreen.vert","heightmap.frag",(function(t){e.heightmapShader=t}))}return e.prototype.draw=function(e,t){var r=t.current,n=e.current;this.stripesCount=this.computeIdealStripeCount();var i,a=this.stripesCount/(this.stripesCount+1),l=1;if(u.Parameters.showHeightmap)i=this.heightmapShader,l=a;else if(i=s.getShader(this.stripesCount)){var c=r.texture.width-2*r.padding,d=r.texture.height-2*r.padding,f=o.gl.canvas.width/(this.stripesCount+1)/(c/d)/o.gl.canvas.height;i.u.uTileTexture.value=r.texture.id,i.u.uTileColor.value=u.Parameters.tileMode!==u.ETileMode.NOISE||u.Parameters.noiseTileColored?1:0,i.u.uTileHeight.value=f,i.u.uTileScaling.value=[c/r.texture.width,d/r.texture.height],i.u.uShowUV.value=u.Parameters.showUV?1:0}if(i){o.gl.bindFramebuffer(o.gl.FRAMEBUFFER,null),o.gl.viewport(0,0,o.gl.canvas.width,o.gl.canvas.height),o.gl.clear(o.gl.COLOR_BUFFER_BIT|o.gl.DEPTH_BUFFER_BIT),i.a.aCorner.VBO=this.fullscreenVBO,i.u.uHeightmapTexture.value=n.id,i.u.uInvertHeightmap.value=u.Parameters.invertHeightmap,i.u.uDepthFactor.value=u.Parameters.depth;var g=o.gl.canvas.width*a/o.gl.canvas.height,h=n.width/n.height;return i.u.uHeightmapScaling.value=g>h?[g/h/l,1]:[1/l,h/g],i.use(),i.bindUniformsAndAttributes(),o.gl.drawArrays(o.gl.TRIANGLE_STRIP,0,4),!0}return!1},e.prototype.computeIdealStripeCount=function(){if(u.Parameters.stripesMode===u.EStripesMode.ADAPTATIVE){var t=Math.round(o.gl.canvas.width/u.Parameters.stripesWidth);return(0,c.clamp)(e.MIN_STRIPES_COUNT,e.MAX_STRIPES_COUNT,t)}return u.Parameters.stripesCount},e.MIN_STRIPES_COUNT=8,e.MAX_STRIPES_COUNT=24,e}();t.Engine=d},753:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.gl=t.initGL=t.adjustSize=void 0,r(457);var n=null;t.gl=n,t.initGL=function(e){function r(e){Page.Demopage.setErrorMessage("webgl-support",e)}var i=Page.Canvas.getCanvas();if(t.gl=n=i.getContext("webgl",e),null==n){if(t.gl=n=i.getContext("experimental-webgl",e),null==n)return r("Your browser or device does not seem to support WebGL."),!1;r("Your browser or device only supports experimental WebGL.\nThe simulation may not run as expected.")}return n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.clearColor(0,0,0,1),!0},t.adjustSize=function(e){void 0===e&&(e=!1);var t=e?window.devicePixelRatio:1,r=n.canvas,i=Math.floor(r.clientWidth*t),a=Math.floor(r.clientHeight*t);r.width===i&&r.height===a||(r.width=i,r.height=a)}},771:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.GLResource=void 0;var r=function(){function e(e){this._gl=e}return e.prototype.gl=function(){return this._gl},e}();t.GLResource=r},748:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.deleteShader=t.registerShader=t.getShader=t.buildShader=void 0;var o=r(753),l=r(490),u=a(r(71)),s={};function c(e,t){var r=2,n=0;function i(i){function a(t){return t.replace(/#INJECT\(([^)]*)\)/gm,(function(t,r){return e.injected[r]?e.injected[r]:t}))}if(r--,i||n++,0===r){var s=null;if(0===n){var c=u.getSource(e.vertexFilename),d=u.getSource(e.fragmentFilename),f=a(c),g=a(d);s=new l.Shader(o.gl,f,g)}t(s)}}u.loadSource(e.vertexFilename,i),u.loadSource(e.fragmentFilename,i)}t.getShader=function(e){return s[e].shader},t.buildShader=c,t.registerShader=function(e,t,r){function n(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed,e.shader);e.callbacks=[]}if(void 0===s[e]){s[e]={callbacks:[r],failed:!1,infos:t,pending:!0,shader:null};var i=s[e];c(t,(function(e){i.pending=!1,i.failed=null===e,i.shader=e,n(i)}))}else{var a=s[e];!0===a.pending?a.callbacks.push(r):n(a)}},t.deleteShader=function(e){void 0!==s[e]&&(null!==s[e].shader&&s[e].shader.freeGLResources(),delete s[e])}},71:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.loadSource=t.getSource=void 0;var r={};t.loadSource=function(e,t){function n(e){for(var t=0,r=e.callbacks;t<r.length;t++)(0,r[t])(!e.failed);e.callbacks=[]}if(void 0===r[e]){r[e]={callbacks:[t],failed:!1,pending:!0,text:null};var i=r[e],a="./shaders/"+e;void 0!==Page.version&&(a+="?v=".concat(Page.version));var o=new XMLHttpRequest;o.open("GET",a,!0),o.onload=function(){4===o.readyState&&(i.pending=!1,200===o.status?(i.text=o.responseText,i.failed=!1):(console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.failed=!0),n(i))},o.onerror=function(){console.error("Cannot load '".concat(e,"' shader source: ").concat(o.statusText)),i.pending=!1,i.failed=!0,n(i)},o.send(null)}else{var l=r[e];!0===l.pending?l.callbacks.push(t):(l.callbacks=[t],n(l))}},t.getSource=function(e){return r[e].text}},490:function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var a=r(771);function o(){alert("NOT IMPLEMENTED YET")}var l={35664:{str:"FLOAT_VEC2",binder:function(e,t,r){e.uniform2fv(t,r)}},35665:{str:"FLOAT_VEC3",binder:function(e,t,r){e.uniform3fv(t,r)}},35666:{str:"FLOAT_VEC4",binder:function(e,t,r){e.uniform4fv(t,r)}},35667:{str:"INT_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35668:{str:"INT_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35669:{str:"INT_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35670:{str:"BOOL",binder:function(e,t,r){e.uniform1i(t,+r)}},35671:{str:"BOOL_VEC2",binder:function(e,t,r){e.uniform2iv(t,r)}},35672:{str:"BOOL_VEC3",binder:function(e,t,r){e.uniform3iv(t,r)}},35673:{str:"BOOL_VEC4",binder:function(e,t,r){e.uniform4iv(t,r)}},35674:{str:"FLOAT_MAT2",binder:function(e,t,r){e.uniformMatrix2fv(t,!1,r)}},35675:{str:"FLOAT_MAT3",binder:function(e,t,r){e.uniformMatrix3fv(t,!1,r)}},35676:{str:"FLOAT_MAT4",binder:function(e,t,r){e.uniformMatrix4fv(t,!1,r)}},35678:{str:"SAMPLER_2D",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_2D,n)}},35680:{str:"SAMPLER_CUBE",binder:function(e,t,r,n){e.uniform1i(t,r),e.activeTexture(e["TEXTURE"+r]),e.bindTexture(e.TEXTURE_CUBE_MAP,n)}},5120:{str:"BYTE",binder:o},5121:{str:"UNSIGNED_BYTE",binder:o},5122:{str:"SHORT",binder:o},5123:{str:"UNSIGNED_SHORT",binder:o},5124:{str:"INT",binder:function(e,t,r){Array.isArray(r),e.uniform1iv(t,r)}},5125:{str:"UNSIGNED_INT",binder:o},5126:{str:"FLOAT",binder:function(e,t,r){Array.isArray(r)?e.uniform1fv(t,r):e.uniform1f(t,r)}}},u=function(e){function t(t,r,n){var i=this;function a(e,r){var n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.error(t.getShaderInfoLog(n)),console.log(r),t.deleteShader(n),null)}(i=e.call(this,t)||this).id=null,i.uCount=0,i.aCount=0;var o=a(t.VERTEX_SHADER,r),l=a(t.FRAGMENT_SHADER,n),u=t.createProgram();return t.attachShader(u,o),t.attachShader(u,l),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)?(i.id=u,i.introspection()):(console.error(t.getProgramInfoLog(u)),t.deleteProgram(u)),i}return i(t,e),t.prototype.freeGLResources=function(){e.prototype.gl.call(this).deleteProgram(this.id),this.id=null},t.prototype.use=function(){e.prototype.gl.call(this).useProgram(this.id)},t.prototype.bindUniforms=function(){var t=this,r=e.prototype.gl.call(this),n=0;Object.keys(this.u).forEach((function(e){var i=t.u[e];if(null!==i.value)if(35678===i.type||35680===i.type){var a=n;l[i.type].binder(r,i.loc,a,i.value),n++}else l[i.type].binder(r,i.loc,i.value)}))},t.prototype.bindAttributes=function(){var e=this;Object.keys(this.a).forEach((function(t){var r=e.a[t];null!==r.VBO&&r.VBO.bind(r.loc)}))},t.prototype.bindUniformsAndAttributes=function(){this.bindUniforms(),this.bindAttributes()},t.prototype.introspection=function(){var t=e.prototype.gl.call(this);this.uCount=t.getProgramParameter(this.id,t.ACTIVE_UNIFORMS),this.u={};for(var r=0;r<this.uCount;r++){var n=t.getActiveUniform(this.id,r),i=n.name;this.u[i]={loc:t.getUniformLocation(this.id,i),size:n.size,type:n.type,value:null}}for(this.aCount=t.getProgramParameter(this.id,t.ACTIVE_ATTRIBUTES),this.a={},r=0;r<this.aCount;r++){var a=t.getActiveAttrib(this.id,r),o=a.name;this.a[o]={VBO:null,loc:t.getAttribLocation(this.id,o),size:a.size,type:a.type}}},t}(a.GLResource);t.Shader=u},62:function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VBO=void 0;var a,o=r(771);!function(e){e[e.DYNAMIC=0]="DYNAMIC",e[e.STATIC=1]="STATIC"}(a||(a={}));var l=function(e){function t(t,r,n,i,o){void 0===o&&(o=!0);var l=e.call(this,t)||this;return l.id=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,l.id),o?t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW):t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),l.size=n,l.type=i,l.normalize=!1,l.stride=0,l.offset=0,l.usage=o?a.STATIC:a.DYNAMIC,l}return i(t,e),t.createQuad=function(e,r,n,i,a){return new t(e,new Float32Array([r,n,i,n,r,a,i,a]),2,e.FLOAT,!0)},t.prototype.freeGLResources=function(){this.gl().deleteBuffer(this.id),this.id=null},t.prototype.bind=function(t){var r=e.prototype.gl.call(this);r.enableVertexAttribArray(t),r.bindBuffer(r.ARRAY_BUFFER,this.id),r.vertexAttribPointer(t,this.size,this.type,this.normalize,this.stride,this.offset)},t.prototype.setData=function(t){var r=e.prototype.gl.call(this);r.bindBuffer(r.ARRAY_BUFFER,this.id),this.usage===a.STATIC?r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW):r.bufferData(r.ARRAY_BUFFER,t,r.DYNAMIC_DRAW),r.bindBuffer(r.ARRAY_BUFFER,null)},t}(o.GLResource);t.VBO=l},28:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Heightmap=void 0;var n=r(753),i=r(61),a=r(657),o=r(645),l=function(){function e(){var e=this;this.heightmapTexture=new o.ImageTexture,this.scene=new a.Scene,i.Parameters.heightmapChangeObservers.push((function(t){e.heightmapTexture.uploadToGPU(t)}))}return Object.defineProperty(e.prototype,"current",{get:function(){return i.Parameters.heightmapMode===i.EHeightmapMode.MOVING?(this.scene.computeDepthMap(n.gl.canvas.width,n.gl.canvas.height),this.scene.depthMap):this.heightmapTexture},enumerable:!1,configurable:!0}),e}();t.Heightmap=l},268:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.registerLoadingObject=t.registerLoadedObject=void 0,r(457);var n={};t.registerLoadingObject=function(e){0===Object.keys(n).length&&Page.Canvas.showLoader(!0),n[e]=!1},t.registerLoadedObject=function(e){delete n[e],0===Object.keys(n).length&&Page.Canvas.showLoader(!1)}},633:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});var o=a(r(753)),l=r(753),u=r(852),s=r(28),c=r(61),d=r(519);r(457),function(){if(o.initGL({alpha:!1,antialias:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1})){l.gl.disable(l.gl.CULL_FACE),l.gl.disable(l.gl.BLEND),l.gl.enable(l.gl.DEPTH_TEST),l.gl.disable(l.gl.STENCIL_TEST);var e=Page.Canvas.getCanvas(),t=new u.Engine,r=new s.Heightmap,n=new d.Tile,i=0;setInterval((function(){Page.Canvas.setIndicatorText("fps-indicator",Math.round(i).toFixed(0)),i=0;var e=n.current.texture;Page.Canvas.setIndicatorText("tilesize-indicator","".concat(e.width,"x").concat(e.height)),Page.Canvas.setIndicatorText("stripes-count-indicator",t.stripesCount.toFixed(0))}),1e3);var a=!1;c.Parameters.imageDownloadObservers.push((function(){a=!0}));var f=!0;c.Parameters.redrawObservers.push((function(){f=!0}));var g=!0;c.Parameters.recomputeNoiseTileObservers.push((function(){g=!0})),function l(){if(i++,a&&(t.draw(r,n),function(e){var t="stereogram.png";if(e.msToBlob){var r=e.msToBlob();window.navigator.msSaveBlob(r,t)}else e.toBlob((function(e){var r=document.createElement("a");r.download=t,r.href=URL.createObjectURL(e),r.click()}))}(e),a=!1),c.Parameters.heightmapMode===c.EHeightmapMode.MOVING&&(g=!0,f=!0),g&&c.Parameters.tileMode===c.ETileMode.NOISE){var u=c.Parameters.noiseTileResolution,s=c.Parameters.noiseTileSquare?u:5*u;g=!n.randomize(u,s)}f&&(o.adjustSize(!1),f=!t.draw(r,n)),requestAnimationFrame(l)}()}}()},40:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.ObjModel=t.asyncLoadObjModel=void 0;var o=r(753),l=r(62),u=a(r(268)),s=function(){function e(e){if(e.length%9!=0)throw new Error("Invalid data: ".concat(e.length));this.data=e,this.trianglesCount=e.length/9,this.VBO=new l.VBO(o.gl,this.data,3,o.gl.FLOAT,!0)}return e.parse=function(t){for(var r=t.split("\n"),n=[],i=[],a=0;a<r.length;a++){var o=r[a].trim(),l=o.split(/\s+/),u=l[0];if("v"===u){if(!(l.length>=4)){console.log("Ignoring line ".concat(a," because it does not have enough items: '").concat(o,"'."));continue}n.push({x:parseFloat(l[1]),y:parseFloat(l[2]),z:parseFloat(l[3])})}else{if("f"!==u){console.log("Ignoring line ".concat(a,": '").concat(o,"'."));continue}if(!(l.length>=4)){console.log("Ignoring line ".concat(a," because only triangular faces are supported: '").concat(o,"'."));continue}for(var s=3;s<l.length;s++){for(var c=[+l[1].split("/")[0],+l[s-1].split("/")[0],+l[s].split("/")[0]],d=0,f=c;d<f.length;d++){var g=f[d];(g<1||g>n.length)&&console.log("Ignoring line ".concat(a," because vertex index ").concat(g," is out of range: '").concat(o,"'."))}i.push(n[c[0]-1].x),i.push(n[c[0]-1].y),i.push(n[c[0]-1].z),i.push(n[c[1]-1].x),i.push(n[c[1]-1].y),i.push(n[c[1]-1].z),i.push(n[c[2]-1].x),i.push(n[c[2]-1].y),i.push(n[c[2]-1].z)}}}return new e(new Float32Array(i))},e}();t.ObjModel=s;var c={};t.asyncLoadObjModel=function(e,t){if(void 0!==c[e])t(c[e]);else{var r="model-".concat(e);u.registerLoadingObject(r);var n=new XMLHttpRequest;n.addEventListener("load",(function(){var i;u.registerLoadedObject(r),200===n.status&&void 0===c[e]&&(c[e]=s.parse(n.responseText)),t(null!==(i=c[e])&&void 0!==i?i:null)})),n.open("GET","resources/models/".concat(e,"?v=").concat(Page.version)),n.send()}}},457:function(){},61:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Parameters=t.ETileMode=t.EStripesMode=t.EHeightmapMode=void 0;var o=a(r(268));r(457);var l,u,s,c={TILE_MODE_TABS:"tile-mode-tabs-id",TILE_PRESET_SELECT:"tile-preset-select-id",TILE_NOISE_RESOLUTION:"tile-noise-resolution-range-id",TILE_NOISE_SQUARE:"tile-noise-square-checkbox-id",TILE_NOISE_COLORED:"tile-noise-colored-checkbox-id",SHOW_UV:"show-uv-checkbox-id",TILE_UPLOAD_BUTTON:"input-tile-upload-button",HEIGHTMAP_MODE_TABS:"heightmap-mode-tabs-id",HEIGHTMAP_PRESET_SELECT:"heightmap-preset-select-id",MODEL_PRESET_SELECT:"model-preset-select-id",DEPTH_RANGE:"depth-range-id",HEIGHTMAP_INVERT_CHECKBOX:"invert-heightmap-checkbox-id",SHOW_HEIGHTMAP:"show-heightmap-checkbox-id",HEIGHTMAP_UPLOAD_BUTTON:"input-heightmap-upload-button",STRIPES_MODE_TABS:"stripes-mode-tabs-id",STRIPES_WIDTH_RANGE:"stripes-width-range-id",STRIPES_COUNT_RANGE:"stripes-count-range-id",SHOW_INDICATORS_CHECKBOX:"show-indicators-checkbox-id",IMAGE_DOWNLOAD:"image-download-id"};function d(e){for(var t=0,r=e;t<r.length;t++)(0,r[t])()}function f(){d(h.redrawObservers)}function g(){d(h.recomputeNoiseTileObservers),f()}!function(e){e.TEXTURE="texture",e.NOISE="noise"}(l||(l={})),t.ETileMode=l,function(e){e.STILL="still",e.MOVING="moving"}(u||(u={})),t.EHeightmapMode=u,function(e){e.ADAPTATIVE="adaptative",e.FIXED="fixed"}(s||(s={})),t.EStripesMode=s;var h=function(){function e(){}return Object.defineProperty(e,"tileMode",{get:function(){return Page.Tabs.getValues(c.TILE_MODE_TABS)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseTileResolution",{get:function(){return Page.Range.getValue(c.TILE_NOISE_RESOLUTION)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseTileSquare",{get:function(){return Page.Checkbox.isChecked(c.TILE_NOISE_SQUARE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"noiseTileColored",{get:function(){return Page.Checkbox.isChecked(c.TILE_NOISE_COLORED)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showUV",{get:function(){return Page.Checkbox.isChecked(c.SHOW_UV)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"heightmapMode",{get:function(){return Page.Tabs.getValues(c.HEIGHTMAP_MODE_TABS)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"modelId",{get:function(){return Page.Select.getValue(c.MODEL_PRESET_SELECT)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"depth",{get:function(){return Page.Range.getValue(c.DEPTH_RANGE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"invertHeightmap",{get:function(){return Page.Checkbox.isChecked(c.HEIGHTMAP_INVERT_CHECKBOX)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"showHeightmap",{get:function(){return Page.Checkbox.isChecked(c.SHOW_HEIGHTMAP)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"stripesMode",{get:function(){return Page.Tabs.getValues(c.STRIPES_MODE_TABS)[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"stripesCount",{get:function(){return Page.Range.getValue(c.STRIPES_COUNT_RANGE)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"stripesWidth",{get:function(){return Page.Range.getValue(c.STRIPES_WIDTH_RANGE)},enumerable:!1,configurable:!0}),e.tileChangeObservers=[],e.heightmapChangeObservers=[],e.redrawObservers=[],e.recomputeNoiseTileObservers=[],e.imageDownloadObservers=[],e}();function E(e,t){if(1===e.length){var r=new FileReader;r.onload=function(){var e=new Image;e.addEventListener("load",(function(){t(e)})),e.src=r.result},r.readAsDataURL(e[0])}}function T(e,t){e+="?v=".concat(Page.version),o.registerLoadingObject(e);var r=new Image;r.addEventListener("load",(function(){o.registerLoadedObject(e),t(r)})),r.src=e}function p(){var e=h.tileMode===l.NOISE;Page.Controls.setVisibility(c.TILE_NOISE_RESOLUTION,e),Page.Controls.setVisibility(c.TILE_NOISE_COLORED,e),Page.Controls.setVisibility(c.TILE_NOISE_SQUARE,e),Page.Controls.setVisibility(c.TILE_PRESET_SELECT,!e),Page.Controls.setVisibility(c.TILE_UPLOAD_BUTTON,!e);var t=h.heightmapMode===u.MOVING;Page.Controls.setVisibility(c.HEIGHTMAP_PRESET_SELECT,!t),Page.Controls.setVisibility(c.HEIGHTMAP_UPLOAD_BUTTON,!t),Page.Controls.setVisibility(c.MODEL_PRESET_SELECT,t)}t.Parameters=h,Page.Canvas.Observers.canvasResize.push(f),Page.Checkbox.addObserver(c.SHOW_HEIGHTMAP,f),Page.Range.addObserver(c.DEPTH_RANGE,f),Page.Checkbox.addObserver(c.HEIGHTMAP_INVERT_CHECKBOX,f),Page.Tabs.addObserver(c.HEIGHTMAP_MODE_TABS,(function(){h.heightmapMode===u.MOVING&&(Page.Tabs.setValues(c.TILE_MODE_TABS,[l.NOISE]),Page.Tabs.clearStoredState(c.TILE_MODE_TABS)),p(),f()}));var _=function(e,t){if(Page.Select.getValue(c.HEIGHTMAP_PRESET_SELECT)===e){for(var r=0,n=h.heightmapChangeObservers;r<n.length;r++)(0,n[r])(t);f()}};Page.FileControl.addUploadObserver(c.HEIGHTMAP_UPLOAD_BUTTON,(function(e){Page.Select.setValue(c.HEIGHTMAP_PRESET_SELECT,null),E(e,_.bind(null,null))}));var b=function(){var e=Page.Select.getValue(c.HEIGHTMAP_PRESET_SELECT);e&&(Page.FileControl.clearFileUpload(c.HEIGHTMAP_UPLOAD_BUTTON),T("resources/heightmaps/".concat(e),_.bind(null,e)))};Page.Select.addObserver(c.HEIGHTMAP_PRESET_SELECT,b),b(),Page.Checkbox.addObserver(c.SHOW_UV,f),Page.Tabs.addObserver(c.TILE_MODE_TABS,(function(){p(),f()}));var v=function(e,t){if(Page.Select.getValue(c.TILE_PRESET_SELECT)===e){for(var r=0,n=h.tileChangeObservers;r<n.length;r++)(0,n[r])(t);f()}};Page.FileControl.addUploadObserver(c.TILE_UPLOAD_BUTTON,(function(e){Page.Select.setValue(c.TILE_PRESET_SELECT,null),E(e,v.bind(null,null))}));var O=function(){var e=Page.Select.getValue(c.TILE_PRESET_SELECT);e&&(Page.FileControl.clearFileUpload(c.TILE_UPLOAD_BUTTON),T("resources/tiles/".concat(e),v.bind(null,e)))};Page.Select.addObserver(c.TILE_PRESET_SELECT,O),O(),Page.Range.addObserver(c.TILE_NOISE_RESOLUTION,g),Page.Checkbox.addObserver(c.TILE_NOISE_SQUARE,g),Page.Checkbox.addObserver(c.TILE_NOISE_COLORED,g);var m=function(){var e=h.stripesMode===s.ADAPTATIVE;Page.Controls.setVisibility(c.STRIPES_COUNT_RANGE,!e),Page.Controls.setVisibility(c.STRIPES_WIDTH_RANGE,e)},P=function(){m(),f()};function S(){Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(c.SHOW_INDICATORS_CHECKBOX))}Page.Tabs.addObserver(c.STRIPES_MODE_TABS,P),Page.Range.addObserver(c.STRIPES_COUNT_RANGE,P),Page.Range.addObserver(c.STRIPES_WIDTH_RANGE,P),m(),Page.FileControl.addDownloadObserver(c.IMAGE_DOWNLOAD,(function(){d(h.imageDownloadObservers)})),Page.Checkbox.addObserver(c.SHOW_INDICATORS_CHECKBOX,S),S(),p()},657:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;var n=r(753),i=r(40),a=r(61),o=r(221),l=r(513),u={primitives:{modelName:"primitives.obj",cameraPosition:[-1.3,0,-.54],nearPlane:.6,farPlane:2.2},cube:{modelName:"cube.obj",cameraPosition:[-2,0,-1],nearPlane:1.3,farPlane:3},monkey:{modelName:"monkey.obj",cameraPosition:[-1.3,0,-.5],nearPlane:.7,farPlane:2},bunny:{modelName:"bunny.obj",cameraPosition:[-1.7,0,-.8],nearPlane:.9,farPlane:2.3},atomium:{modelName:"atomium.obj",cameraPosition:[-2.5,0,-.6],nearPlane:1.5,farPlane:3.4}},s=function(){function e(){var e=this;this._depthMap=new o.RenderToTextureWithDepth,this.modelMatrix=mat4.create(),this.viewMatrix=mat4.create(),this.projectionMatrix=mat4.create(),this.mvMatrix=mat4.create(),this.mvpMatrix=mat4.create(),(0,l.asyncLoadShader)("scene","scene.vert","scene.frag",(function(t){t.u.uMVPMatrix.value=e.mvpMatrix,e.shader=t}))}return e.prototype.computeDepthMap=function(e,t){if(this.shader){var r=u[a.Parameters.modelId];if(mat4.lookAt(this.viewMatrix,r.cameraPosition,[0,0,0],[0,0,1]),mat4.fromRotation(this.modelMatrix,5e-4*performance.now(),[0,0,1]),mat4.multiply(this.mvMatrix,this.viewMatrix,this.modelMatrix),mat4.perspective(this.projectionMatrix,45,e/t,r.nearPlane,r.farPlane),mat4.multiply(this.mvpMatrix,this.projectionMatrix,this.mvMatrix),this._depthMap.reserveSpace(e,t),n.gl.bindFramebuffer(n.gl.FRAMEBUFFER,this._depthMap.framebuffer),n.gl.viewport(0,0,this._depthMap.width,this._depthMap.height),n.gl.clear(n.gl.COLOR_BUFFER_BIT|n.gl.DEPTH_BUFFER_BIT),void 0===r.model){r.model=null;var o=a.Parameters.modelId;(0,i.asyncLoadObjModel)(r.modelName,(function(e){o===a.Parameters.modelId&&(r.model=e)}))}if(r.model){var l=r.model;this.shader.a.aVertice.VBO=l.VBO,this.shader.use(),this.shader.bindUniformsAndAttributes(),n.gl.drawArrays(n.gl.TRIANGLES,0,3*l.trianglesCount)}}},Object.defineProperty(e.prototype,"depthMap",{get:function(){return this._depthMap},enumerable:!1,configurable:!0}),e}();t.Scene=s},586:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.getShader=void 0;var n=r(513),i={};t.getShader=function(e){return i[e]?i[e]:(void 0===i[e]&&(i[e]=null,(0,n.asyncLoadShader)("stereomap","fullscreen.vert","stereogram.frag",(function(t){i[e]=t}),{STRIPES_COUNT:e.toFixed(1),LOOP_SIZE:Math.ceil(2*e).toFixed(0)})),null)}},645:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.ImageTexture=void 0;var n=r(753),i=(0,r(513).createImageData)(1,1,new Uint8ClampedArray([0,0,0,0])),a=function(){function e(){this._width=-1,this._height=-1,this.id=n.gl.createTexture(),this.uploadToGPU(i)}return e.prototype.uploadToGPU=function(e){this._width=e.width,this._height=e.height,n.gl.bindTexture(n.gl.TEXTURE_2D,this.id),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_S,n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_T,n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_MIN_FILTER,n.gl.LINEAR),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_MAG_FILTER,n.gl.LINEAR),n.gl.texImage2D(n.gl.TEXTURE_2D,0,n.gl.RGBA,n.gl.RGBA,n.gl.UNSIGNED_BYTE,e),n.gl.bindTexture(n.gl.TEXTURE_2D,null)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),e}();t.ImageTexture=a},221:function(e,t,r){var n,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTextureWithDepth=void 0;var a=r(753),o=r(991);r(457);var l=function(e){function t(){var t=e.call(this)||this;return a.gl.getExtension("WEBGL_depth_texture")?t.depthTexture=a.gl.createTexture():Page.Demopage.setErrorMessage("WEBGL_depth_texture-unavailable","WebGL extension 'WEBGL_depth_texture' is not available."),t}return i(t,e),t.prototype.reserveSpaceInternal=function(){e.prototype.reserveSpaceInternal.call(this),this.depthTexture&&(a.gl.bindTexture(a.gl.TEXTURE_2D,this.depthTexture),a.gl.texImage2D(a.gl.TEXTURE_2D,0,a.gl.DEPTH_COMPONENT,this.width,this.height,0,a.gl.DEPTH_COMPONENT,a.gl.UNSIGNED_SHORT,null),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MAG_FILTER,a.gl.NEAREST),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.NEAREST),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_S,a.gl.CLAMP_TO_EDGE),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_WRAP_T,a.gl.CLAMP_TO_EDGE),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,this.framebuffer),a.gl.framebufferTexture2D(a.gl.FRAMEBUFFER,a.gl.DEPTH_ATTACHMENT,a.gl.TEXTURE_2D,this.depthTexture,0),a.gl.bindFramebuffer(a.gl.FRAMEBUFFER,null))},t}(o.RenderToTexture);t.RenderToTextureWithDepth=l},991:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderToTexture=void 0;var n=r(753),i=function(){function e(){this.texture=n.gl.createTexture(),this.framebuffer=n.gl.createFramebuffer(),this._width=-1,this._height=-1}return e.prototype.reserveSpace=function(e,t){e=Math.ceil(e),t=Math.ceil(t),this.width===e&&this.height===t||(this._width=e,this._height=t,this.reserveSpaceInternal())},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.texture},enumerable:!1,configurable:!0}),e.prototype.reserveSpaceInternal=function(){n.gl.bindTexture(n.gl.TEXTURE_2D,this.texture);var e=n.gl.RGBA;n.gl.texImage2D(n.gl.TEXTURE_2D,0,e,this._width,this._height,0,e,n.gl.UNSIGNED_BYTE,null),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_MAG_FILTER,n.gl.LINEAR),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_MIN_FILTER,n.gl.LINEAR),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_S,n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(n.gl.TEXTURE_2D,n.gl.TEXTURE_WRAP_T,n.gl.CLAMP_TO_EDGE),n.gl.bindFramebuffer(n.gl.FRAMEBUFFER,this.framebuffer),n.gl.framebufferTexture2D(n.gl.FRAMEBUFFER,n.gl.COLOR_ATTACHMENT0,n.gl.TEXTURE_2D,this.texture,0),n.gl.bindFramebuffer(n.gl.FRAMEBUFFER,null),n.gl.bindTexture(n.gl.TEXTURE_2D,null)},e}();t.RenderToTexture=i},519:function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.Tile=void 0;var n=r(61),i=r(645),a=r(513),o=function(){function e(){var e=this;this.tileTexture=new i.ImageTexture,n.Parameters.tileChangeObservers.push((function(t){e.tileTexture.uploadToGPU(t)})),this.randomTexture=new i.ImageTexture}return Object.defineProperty(e.prototype,"current",{get:function(){return n.Parameters.tileMode===n.ETileMode.TEXTURE?{texture:this.tileTexture,padding:0}:{texture:this.randomTexture,padding:1}},enumerable:!1,configurable:!0}),e.prototype.randomize=function(e,t){var r=e,n=t;e+=2,t+=2;var i=new Uint8ClampedArray(e*t*4);function o(t,a){for(var o=4*(t+e*a),l=4*((t-1+r)%r+1+e*((a-1+n)%n+1)),u=0;u<4;u++)i[o+u]=i[l+u]}for(var l=1;l<t-1;l++)for(var u=1;u<e-1;u++){var s=4*(u+e*l);i[s+0]=Math.floor(255.9*Math.random()),i[s+1]=Math.floor(255.9*Math.random()),i[s+2]=Math.floor(255.9*Math.random()),i[s+3]=255}for(u=0;u<e;u++)o(u,0),o(u,t-1);for(l=0;l<t;l++)o(0,l),o(e-1,l);var c=(0,a.createImageData)(e,t,i);return this.randomTexture.uploadToGPU(c),!0},e}();t.Tile=o},513:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createImageData=t.clamp=t.asyncLoadShader=void 0;var o,l,u=a(r(748)),s=a(r(268));t.asyncLoadShader=function(e,t,r,n,i){void 0===i&&(i={});var a="shader-".concat(e);s.registerLoadingObject(a),u.buildShader({fragmentFilename:r,vertexFilename:t,injected:i},(function(t){s.registerLoadedObject(a),null!==t?n(t):Page.Demopage.setErrorMessage("".concat(e,"-shader-error"),"Failed to build '".concat(e,"' shader."))}))},t.createImageData=function(e,t,r){if(r.length!==e*t*4)throw new Error("Incoherent image data: width=".concat(e," height=").concat(t," data.length=").concat(r.length));try{return new ImageData(r,e,t)}catch(a){console.log("Failed to create default ImageData from constructor, using Canvas2D instead..."),o||(o=document.createElement("canvas"),l=o.getContext("2d"));for(var n=l.createImageData(e,t),i=0;i<n.data.length;i++)n.data[i]=r[i];return n}},t.clamp=function(e,t,r){return r<e?e:r>t?t:r}}},t={};!function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(633)}();
//# sourceMappingURL=main.min.js.map