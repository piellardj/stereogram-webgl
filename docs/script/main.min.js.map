{"version":3,"file":"main.min.js","mappings":"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","sources":["webpack://stereogram-webgl/./src/ts/engine.ts","webpack://stereogram-webgl/./src/ts/gl-utils/gl-canvas.ts","webpack://stereogram-webgl/./src/ts/gl-utils/gl-resource.ts","webpack://stereogram-webgl/./src/ts/gl-utils/shader-manager.ts","webpack://stereogram-webgl/./src/ts/gl-utils/shader-sources.ts","webpack://stereogram-webgl/./src/ts/gl-utils/shader.ts","webpack://stereogram-webgl/./src/ts/gl-utils/vbo.ts","webpack://stereogram-webgl/./src/ts/gl-utils/viewport.ts","webpack://stereogram-webgl/./src/ts/heightmap.ts","webpack://stereogram-webgl/./src/ts/loader.ts","webpack://stereogram-webgl/./src/ts/main.ts","webpack://stereogram-webgl/./src/ts/obj-model.ts","webpack://stereogram-webgl/./src/ts/parameters.ts","webpack://stereogram-webgl/./src/ts/scene.ts","webpack://stereogram-webgl/./src/ts/stereogram-shader.ts","webpack://stereogram-webgl/./src/ts/texture/image-texture.ts","webpack://stereogram-webgl/./src/ts/texture/render-to-texture-with-depth.ts","webpack://stereogram-webgl/./src/ts/texture/render-to-texture.ts","webpack://stereogram-webgl/./src/ts/tile.ts","webpack://stereogram-webgl/./src/ts/utils.ts","webpack://stereogram-webgl/webpack/bootstrap","webpack://stereogram-webgl/webpack/startup"],"sourcesContent":["import { gl } from \"./gl-utils/gl-canvas\";\r\nimport { Shader } from \"./gl-utils/shader\";\r\nimport { VBO } from \"./gl-utils/vbo\";\r\nimport { Viewport } from \"./gl-utils/viewport\";\r\n\r\nimport { Heightmap } from \"./heightmap\";\r\nimport { EMainStripe, EStripesMode, ETileMode, Parameters } from \"./parameters\";\r\nimport * as StereogramShader from \"./stereogram-shader\";\r\nimport { ImageTexture } from \"./texture/image-texture\";\r\nimport { Tile } from \"./tile\";\r\nimport { asyncLoadShader, clamp } from \"./utils\";\r\n\r\n\r\nclass Engine {\r\n    private static readonly MIN_STRIPES_COUNT: number = 8;\r\n    private static readonly MAX_STRIPES_COUNT: number = 24;\r\n\r\n    private readonly fullscreenVBO: VBO;\r\n\r\n    private heightmapShader: Shader;\r\n    private readonly watermarkTexture: ImageTexture = new ImageTexture();\r\n    private watermarkShader: Shader;\r\n\r\n    public stripesCount: number;\r\n\r\n    public constructor() {\r\n        this.fullscreenVBO = VBO.createQuad(gl, -1, -1, 1, 1);\r\n\r\n        asyncLoadShader(\"heightmap\", \"fullscreen.vert\", \"heightmap.frag\", (shader: Shader) => {\r\n            this.heightmapShader = shader;\r\n        });\r\n        asyncLoadShader(\"creds\", \"fullscreen.vert\", \"copy-texture.frag\", (shader: Shader) => {\r\n            this.watermarkShader = shader;\r\n        });\r\n\r\n        const credImage = new Image();\r\n        const uploadCred = () => {\r\n            this.watermarkTexture.uploadToGPU(credImage);\r\n        };\r\n        credImage.addEventListener(\"load\", uploadCred);\r\n        credImage.src = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAAUCAMAAAAA/fAzAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJUExURQAAAP///wAAAHPGg3EAAAADdFJOU///ANfKDUEAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAKFSURBVFhH7VSLjhsxCEzy/x999jwA492k2Yvaq3SjGJgBbJarenv84o/xu6w38POXdbv9mBm3Qdpsg4Lb71DmLL/oqjUaBbo0a45v/jwOnlqko2TRQAe336EM7Q7pTIJkVaNAl8BTKeHnsT4FrBIDaiN2sLhE13sBLpsQP8FpmxPyFO4kBa6Le6J+9YGNC6Ide7/KYSrabHdx+x3KTIsrByAIS1+7xVRt6KsVm/Ap5HMLDj4SEsuxLKpncP/5zCWjS3ec3GJ62tc7Wv+ncXD9lDielzX2x63etdzh1Yhi+dBRz2BEqfNO60OhjDQDqEqRQnej6PQMyruzni7ywzhYdKj+ZX7SYWcBwTJkWEbmBKJxMF0sCwnkaNOw2CwML6phFE60EluKSPKgZp4JNoM1kyFp4RTMq+fdUFLHCqgBqFnywUsrdxX/Z6nIdi66FssrEUzFCO2AoldLXw5kmAlsK6Wa9DiFLnOIu8beec/tHyjz2J35lMDlZbGq82UhBBymPo3UFMMBRa+WvhzIMIGUpqm5wkNuHH4YeyeKzp/hZQWlsbfFrq4sa/mLzlNis6KnbQd/SfO4RcxG6sLHkRyBObzyeXfy+Bl9WTMQ10S067Lwr5Celad+nKDmCGntMMRaKFkRcmLgdBTsIKaMqAhyGRQ+mydNDsJEQCxz45AjQb0sC8lpvoftig/difmu4On7/PqnqP0sZ4v2eRnaf2ITnkJTHw9fvunF1xW8eh8f/2RbrV/VtSPCV17YHqPQ1SjMxFqiGXKUmsaUEcrDBQ77Cno9biLE4M7hYphFeh/qbyMMiF7G1Sv4+vX31d77yY8y7wD99YJN+Mv47vvH/f/wg/43PB5frhkVzqJiDtMAAAAASUVORK5CYII=\";\r\n        uploadCred();\r\n    }\r\n\r\n    public draw(heightmap: Heightmap, tile: Tile): boolean {\r\n        const currentTile = tile.current;\r\n        const heightmapTexture = heightmap.current;\r\n\r\n        this.stripesCount = this.computeIdealStripeCount();\r\n        const usefulStripesProportion = this.stripesCount / (this.stripesCount + 1);\r\n        let heightmapHScaling = 1;\r\n\r\n        let shader: Shader;\r\n        if (Parameters.showHeightmap) {\r\n            shader = this.heightmapShader;\r\n            heightmapHScaling = usefulStripesProportion;\r\n        } else {\r\n            shader = StereogramShader.getShader(this.stripesCount);\r\n\r\n            if (shader) {\r\n                const tileUsefulWidth = currentTile.texture.width - 2 * currentTile.padding;\r\n                const tileUsefulHeight = currentTile.texture.height - 2 * currentTile.padding;\r\n\r\n                const tileWidthInPixel = this.canvasWidth / (this.stripesCount + 1);\r\n                const tileHeightInPixel = tileWidthInPixel / (tileUsefulWidth / tileUsefulHeight);\r\n                const tileHeight = tileHeightInPixel / this.canvasHeight;\r\n\r\n                shader.u[\"uTileTexture\"].value = currentTile.texture.id;\r\n                shader.u[\"uTileColor\"].value = (Parameters.tileMode === ETileMode.NOISE && !Parameters.noiseTileColored) ? 0 : 1;\r\n                shader.u[\"uTileHeight\"].value = tileHeight;\r\n                shader.u[\"uTileScaling\"].value = [tileUsefulWidth / currentTile.texture.width, -tileUsefulHeight / currentTile.texture.height];\r\n                shader.u[\"uShowUV\"].value = Parameters.showUV ? 1 : 0;\r\n                shader.u[\"uMainStripe\"].value = (Parameters.mainStripe === EMainStripe.LEFT) ? 0 : Math.floor(this.stripesCount / 2);\r\n            }\r\n        }\r\n\r\n        let drewStereogram = false;\r\n        if (shader) {\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n            Viewport.setFullCanvas(gl);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // tslint:disable-line:no-bitwise\r\n\r\n            shader.a[\"aCorner\"].VBO = this.fullscreenVBO;\r\n            shader.u[\"uHeightmapTexture\"].value = heightmapTexture.id;\r\n            shader.u[\"uInvertHeightmap\"].value = Parameters.invertHeightmap;\r\n            shader.u[\"uDepthFactor\"].value = Parameters.depth;\r\n\r\n            const canvasAspectRatio = this.canvasWidth / this.canvasHeight * usefulStripesProportion;\r\n            const heightmapAspectRatio = heightmapTexture.width / heightmapTexture.height;\r\n            if (canvasAspectRatio > heightmapAspectRatio) {\r\n                shader.u[\"uHeightmapScaling\"].value = [canvasAspectRatio / heightmapAspectRatio / heightmapHScaling, -1];\r\n            } else {\r\n                shader.u[\"uHeightmapScaling\"].value = [1 / heightmapHScaling, -heightmapAspectRatio / canvasAspectRatio];\r\n            }\r\n\r\n            shader.use();\r\n            shader.bindUniformsAndAttributes();\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n            drewStereogram = true;\r\n        }\r\n\r\n        let drewWatermark = false;\r\n        if (this.watermarkShader && this.watermarkTexture.width > 0) {\r\n            const watermarkWidth = this.watermarkTexture.width * window.devicePixelRatio;\r\n            const watermarkHeight = this.watermarkTexture.height * window.devicePixelRatio;\r\n            const left = Math.max(0, (gl.canvas.width - watermarkWidth) / 2);\r\n            gl.viewport(left, gl.canvas.height - watermarkHeight, watermarkWidth, watermarkHeight);\r\n            this.watermarkShader.a[\"aCorner\"].VBO = this.fullscreenVBO;\r\n            this.watermarkShader.u[\"uTexture\"].value = this.watermarkTexture.id;\r\n            this.watermarkShader.use();\r\n            this.watermarkShader.bindUniformsAndAttributes();\r\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\r\n            drewWatermark = true;\r\n        }\r\n\r\n        return drewStereogram && drewWatermark;\r\n    }\r\n\r\n    private computeIdealStripeCount(): number {\r\n        if (Parameters.stripesMode === EStripesMode.ADAPTATIVE) {\r\n            const idealCount = Math.round(this.canvasWidth / Parameters.stripesWidth);\r\n            return clamp(Engine.MIN_STRIPES_COUNT, Engine.MAX_STRIPES_COUNT, idealCount);\r\n        } else {\r\n            return Parameters.stripesCount;\r\n        }\r\n    }\r\n\r\n    private get canvasWidth(): number {\r\n        return gl.canvas.width / window.devicePixelRatio;\r\n    }\r\n\r\n    private get canvasHeight(): number {\r\n        return gl.canvas.height / window.devicePixelRatio;\r\n    }\r\n}\r\n\r\nexport {\r\n    Engine\r\n};\r\n\r\n","import \"../page-interface-generated\";\r\n\r\nlet gl: WebGLRenderingContext = null;\r\n\r\n/** Initializes a WebGL context */\r\nfunction initGL(flags?: object): boolean {\r\n    function setError(message: string): void {\r\n        Page.Demopage.setErrorMessage(\"webgl-support\", message);\r\n    }\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    gl = canvas.getContext(\"webgl\", flags) as WebGLRenderingContext;\r\n    if (gl == null) {\r\n        gl = canvas.getContext(\"experimental-webgl\", flags) as WebGLRenderingContext;\r\n        if (gl == null) {\r\n            setError(\"Your browser or device does not seem to support WebGL.\");\r\n            return false;\r\n        }\r\n\r\n        setError(`Your browser or device only supports experimental WebGL.\r\nThe simulation may not run as expected.`);\r\n    }\r\n\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.DEPTH_TEST);\r\n    gl.disable(gl.BLEND);\r\n    gl.clearColor(0, 0, 0, 1);\r\n\r\n    return true;\r\n}\r\n\r\n/* Adjusts the GL canvas size to the actual canvas element size on the page */\r\nfunction adjustSize(hidpi: boolean = false): void {\r\n    const cssPixel: number = (hidpi) ? window.devicePixelRatio : 1;\r\n\r\n    const canvas = gl.canvas as HTMLCanvasElement;\r\n\r\n    const width: number = Math.floor(canvas.clientWidth * cssPixel);\r\n    const height: number = Math.floor(canvas.clientHeight * cssPixel);\r\n    if (canvas.width !== width || canvas.height !== height) {\r\n        canvas.width = width;\r\n        canvas.height = height;\r\n    }\r\n}\r\n\r\nexport {\r\n    adjustSize,\r\n    initGL,\r\n    gl,\r\n};\r\n","abstract class GLResource {\r\n    private _gl: WebGLRenderingContext;\r\n\r\n    constructor(gl: WebGLRenderingContext) {\r\n        this._gl = gl;\r\n    }\r\n\r\n    public gl(): WebGLRenderingContext {\r\n        return this._gl;\r\n    }\r\n\r\n    public abstract freeGLResources(): void;\r\n}\r\n\r\nexport { GLResource };\r\n","import { gl } from \"./gl-canvas\";\r\nimport { Shader } from \"./shader\";\r\nimport * as ShaderSources from \"./shader-sources\";\r\n\r\ntype RegisterCallback = (success: boolean, shader: Shader | null) => void;\r\n\r\ninterface IShaderInfos {\r\n    fragmentFilename: string;\r\n    vertexFilename: string;\r\n    injected: { [id: string]: string };\r\n}\r\n\r\ninterface ICachedShader {\r\n    shader: Shader | null;\r\n    infos: IShaderInfos;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: RegisterCallback[];\r\n}\r\n\r\nconst cachedShaders: { [id: string]: ICachedShader } = {};\r\n\r\nfunction getShader(name: string): Shader | null {\r\n    return cachedShaders[name].shader;\r\n}\r\n\r\ntype BuildCallback = (builtShader: Shader | null) => void;\r\n\r\nfunction buildShader(infos: IShaderInfos, callback: BuildCallback): void {\r\n    let sourcesPending = 2;\r\n    let sourcesFailed = 0;\r\n\r\n    function loadedSource(success: boolean): void {\r\n        function processSource(source: string): string {\r\n            return source.replace(/#INJECT\\(([^)]*)\\)/mg, (match: string, name: string) => {\r\n                if (infos.injected[name]) {\r\n                    return infos.injected[name];\r\n                }\r\n                return match;\r\n            });\r\n        }\r\n\r\n        sourcesPending--;\r\n        if (!success) {\r\n            sourcesFailed++;\r\n        }\r\n\r\n        if (sourcesPending === 0) {\r\n            let shader = null;\r\n\r\n            if (sourcesFailed === 0) {\r\n                const vert = ShaderSources.getSource(infos.vertexFilename);\r\n                const frag = ShaderSources.getSource(infos.fragmentFilename);\r\n\r\n                const processedVert = processSource(vert);\r\n                const processedFrag = processSource(frag);\r\n                shader = new Shader(gl, processedVert, processedFrag);\r\n            }\r\n\r\n            callback(shader);\r\n        }\r\n    }\r\n\r\n    ShaderSources.loadSource(infos.vertexFilename, loadedSource);\r\n    ShaderSources.loadSource(infos.fragmentFilename, loadedSource);\r\n}\r\n\r\nfunction registerShader(name: string, infos: IShaderInfos, callback: RegisterCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedShader): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed, cached.shader);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedShaders[name] === \"undefined\") {\r\n        cachedShaders[name] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            infos,\r\n            pending: true,\r\n            shader: null,\r\n        };\r\n        const cached = cachedShaders[name];\r\n\r\n        buildShader(infos, (builtShader: Shader | null) => {\r\n            cached.pending = false;\r\n            cached.failed = builtShader === null;\r\n            cached.shader = builtShader;\r\n\r\n            callAndClearCallbacks(cached);\r\n        });\r\n    } else {\r\n        const cached = cachedShaders[name];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction deleteShader(name: string): void {\r\n    if (typeof cachedShaders[name] !== \"undefined\") {\r\n        if (cachedShaders[name].shader !== null) {\r\n            cachedShaders[name].shader.freeGLResources();\r\n        }\r\n        delete cachedShaders[name];\r\n    }\r\n}\r\n\r\nexport {\r\n    buildShader,\r\n    getShader,\r\n    IShaderInfos,\r\n    registerShader,\r\n    deleteShader,\r\n};\r\n","type LoadCallback = (success: boolean) => void;\r\n\r\ninterface ICachedSource {\r\n    text: string;\r\n    pending: boolean;\r\n    failed: boolean;\r\n    callbacks: LoadCallback[];\r\n}\r\n\r\nconst cachedSources: { [id: string]: ICachedSource } = {};\r\n\r\n/* Fetches asynchronously the shader source from server and stores it in cache. */\r\nfunction loadSource(filename: string, callback: LoadCallback): void {\r\n    function callAndClearCallbacks(cached: ICachedSource): void {\r\n        for (const cachedCallback of cached.callbacks) {\r\n            cachedCallback(!cached.failed);\r\n        }\r\n\r\n        cached.callbacks = [];\r\n    }\r\n\r\n    if (typeof cachedSources[filename] === \"undefined\") {\r\n        cachedSources[filename] = {\r\n            callbacks: [callback],\r\n            failed: false,\r\n            pending: true,\r\n            text: null,\r\n        };\r\n        const cached = cachedSources[filename];\r\n\r\n        let url = \"./shaders/\" + filename;\r\n        if (typeof Page.version !== \"undefined\") {\r\n            url += `?v=${Page.version}`;\r\n        }\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.open(\"GET\", url, true);\r\n        xhr.onload = () => {\r\n            if (xhr.readyState === 4) {\r\n                cached.pending = false;\r\n\r\n                if (xhr.status === 200) {\r\n                    cached.text = xhr.responseText;\r\n                    cached.failed = false;\r\n                } else {\r\n                    console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n                    cached.failed = true;\r\n                }\r\n\r\n                callAndClearCallbacks(cached);\r\n            }\r\n        };\r\n        xhr.onerror = () => {\r\n            console.error(`Cannot load '${filename}' shader source: ${xhr.statusText}`);\r\n            cached.pending = false;\r\n            cached.failed = true;\r\n            callAndClearCallbacks(cached);\r\n        };\r\n\r\n        xhr.send(null);\r\n    } else {\r\n        const cached = cachedSources[filename];\r\n\r\n        if (cached.pending === true) {\r\n            cached.callbacks.push(callback);\r\n        } else {\r\n            cached.callbacks = [callback];\r\n            callAndClearCallbacks(cached);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getSource(filename: string): string {\r\n    return cachedSources[filename].text;\r\n}\r\n\r\nexport {\r\n    getSource,\r\n    loadSource,\r\n};\r\n","import { GLResource } from \"./gl-resource\";\r\nimport { VBO } from \"./vbo\";\r\n\r\nfunction notImplemented(): void {\r\n    alert(\"NOT IMPLEMENTED YET\");\r\n}\r\n\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformFloat(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1fv(location, value);\r\n    } else {\r\n        gl.uniform1f(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformFloat2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3fv(location, value);\r\n}\r\n\r\nfunction bindUniformFloat4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4fv(location, value);\r\n}\r\n\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number | number[]): void;\r\nfunction bindUniformInt(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    if (Array.isArray(value)) {\r\n        gl.uniform1iv(location, value);\r\n    } else {\r\n        gl.uniform1iv(location, value);\r\n    }\r\n}\r\n\r\nfunction bindUniformInt2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformInt4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: boolean | number): void {\r\n    gl.uniform1i(location, +value);\r\n}\r\n\r\nfunction bindUniformBool2v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform2iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool3v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform3iv(location, value);\r\n}\r\n\r\nfunction bindUniformBool4v(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: any): void {\r\n    gl.uniform4iv(location, value);\r\n}\r\n\r\nfunction bindUniformFloatMat2(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix2fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat3(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix3fv(location, false, value);\r\n}\r\n\r\nfunction bindUniformFloatMat4(gl: WebGLRenderingContext, location: WebGLUniformLocation, value: number[]): void {\r\n    gl.uniformMatrix4fv(location, false, value);\r\n}\r\n\r\nfunction bindSampler2D(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_2D, value);\r\n}\r\n\r\nfunction bindSamplerCube(gl: WebGLRenderingContext, location: WebGLUniformLocation, unitNb: number,\r\n    value: WebGLTexture): void {\r\n    gl.uniform1i(location, unitNb);\r\n    gl.activeTexture((gl as any)[\"TEXTURE\" + unitNb] as number);\r\n    gl.bindTexture(gl.TEXTURE_CUBE_MAP, value);\r\n}\r\n\r\n/* From WebGL spec:\r\n* http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.14 */\r\ninterface IBindingType {\r\n    str: string;\r\n    binder: (...args: any[]) => unknown;\r\n}\r\nconst types: { [index: string]: IBindingType } = {\r\n    0x8B50: { str: \"FLOAT_VEC2\", binder: bindUniformFloat2v },\r\n    0x8B51: { str: \"FLOAT_VEC3\", binder: bindUniformFloat3v },\r\n    0x8B52: { str: \"FLOAT_VEC4\", binder: bindUniformFloat4v },\r\n    0x8B53: { str: \"INT_VEC2\", binder: bindUniformInt2v },\r\n    0x8B54: { str: \"INT_VEC3\", binder: bindUniformInt3v },\r\n    0x8B55: { str: \"INT_VEC4\", binder: bindUniformInt4v },\r\n    0x8B56: { str: \"BOOL\", binder: bindUniformBool },\r\n    0x8B57: { str: \"BOOL_VEC2\", binder: bindUniformBool2v },\r\n    0x8B58: { str: \"BOOL_VEC3\", binder: bindUniformBool3v },\r\n    0x8B59: { str: \"BOOL_VEC4\", binder: bindUniformBool4v },\r\n    0x8B5A: { str: \"FLOAT_MAT2\", binder: bindUniformFloatMat2 },\r\n    0x8B5B: { str: \"FLOAT_MAT3\", binder: bindUniformFloatMat3 },\r\n    0x8B5C: { str: \"FLOAT_MAT4\", binder: bindUniformFloatMat4 },\r\n    0x8B5E: { str: \"SAMPLER_2D\", binder: bindSampler2D },\r\n    0x8B60: { str: \"SAMPLER_CUBE\", binder: bindSamplerCube },\r\n    0x1400: { str: \"BYTE\", binder: notImplemented },\r\n    0x1401: { str: \"UNSIGNED_BYTE\", binder: notImplemented },\r\n    0x1402: { str: \"SHORT\", binder: notImplemented },\r\n    0x1403: { str: \"UNSIGNED_SHORT\", binder: notImplemented },\r\n    0x1404: { str: \"INT\", binder: bindUniformInt },\r\n    0x1405: { str: \"UNSIGNED_INT\", binder: notImplemented },\r\n    0x1406: { str: \"FLOAT\", binder: bindUniformFloat },\r\n};\r\n\r\ninterface IShaderUniform {\r\n    value: boolean | boolean[] | number | number[] | WebGLTexture | WebGLTexture[];\r\n    loc: WebGLUniformLocation;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\ninterface IShaderAttribute {\r\n    VBO: VBO;\r\n    loc: GLint;\r\n    size: number;\r\n    type: number;\r\n}\r\n\r\nclass ShaderProgram extends GLResource {\r\n    public u: { [name: string]: IShaderUniform };\r\n    public a: { [name: string]: IShaderAttribute };\r\n\r\n    private id: WebGLProgram;\r\n    private uCount: number;\r\n    private aCount: number;\r\n\r\n    constructor(gl: WebGLRenderingContext, vertexSource: string, fragmentSource: string) {\r\n        function createShader(type: GLenum, source: string): WebGLShader {\r\n            const shader = gl.createShader(type);\r\n            gl.shaderSource(shader, source);\r\n            gl.compileShader(shader);\r\n\r\n            const compileSuccess = gl.getShaderParameter(shader, gl.COMPILE_STATUS);\r\n            if (!compileSuccess) {\r\n                console.error(gl.getShaderInfoLog(shader));\r\n                console.log(source);\r\n                gl.deleteShader(shader);\r\n                return null;\r\n            }\r\n\r\n            return shader;\r\n        }\r\n\r\n        super(gl);\r\n\r\n        this.id = null;\r\n        this.uCount = 0;\r\n        this.aCount = 0;\r\n\r\n        const vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n        const fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n        const id = gl.createProgram();\r\n        gl.attachShader(id, vertexShader);\r\n        gl.attachShader(id, fragmentShader);\r\n        gl.linkProgram(id);\r\n\r\n        const linkSuccess = gl.getProgramParameter(id, gl.LINK_STATUS);\r\n        if (!linkSuccess) {\r\n            console.error(gl.getProgramInfoLog(id));\r\n            gl.deleteProgram(id);\r\n        } else {\r\n            this.id = id;\r\n\r\n            this.introspection();\r\n        }\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        super.gl().deleteProgram(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public use(): void {\r\n        super.gl().useProgram(this.id);\r\n    }\r\n\r\n    public bindUniforms(): void {\r\n        const gl: WebGLRenderingContext = super.gl();\r\n        let currTextureUnitNb: number = 0;\r\n\r\n        Object.keys(this.u).forEach((uName: string) => {\r\n            const uniform = this.u[uName];\r\n            if (uniform.value !== null) {\r\n                if (uniform.type === 0x8B5E || uniform.type === 0x8B60) {\r\n                    const unitNb: number = currTextureUnitNb;\r\n                    types[uniform.type].binder(gl, uniform.loc, unitNb, uniform.value);\r\n                    currTextureUnitNb++;\r\n                } else {\r\n                    types[uniform.type].binder(gl, uniform.loc, uniform.value);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindAttributes(): void {\r\n        Object.keys(this.a).forEach((aName: string) => {\r\n            const attribute = this.a[aName];\r\n            if (attribute.VBO !== null) {\r\n                attribute.VBO.bind(attribute.loc);\r\n            }\r\n        });\r\n    }\r\n\r\n    public bindUniformsAndAttributes(): void {\r\n        this.bindUniforms();\r\n        this.bindAttributes();\r\n    }\r\n\r\n    private introspection(): void {\r\n        const gl = super.gl();\r\n\r\n        this.uCount = gl.getProgramParameter(this.id, gl.ACTIVE_UNIFORMS);\r\n        this.u = {};\r\n        for (let i = 0; i < this.uCount; i++) {\r\n            const uniform = gl.getActiveUniform(this.id, i);\r\n            const name = uniform.name;\r\n\r\n            this.u[name] = {\r\n                loc: gl.getUniformLocation(this.id, name),\r\n                size: uniform.size,\r\n                type: uniform.type,\r\n                value: null,\r\n            };\r\n        }\r\n\r\n        this.aCount = gl.getProgramParameter(this.id, gl.ACTIVE_ATTRIBUTES);\r\n        this.a = {};\r\n        for (let i = 0; i < this.aCount; i++) {\r\n            const attribute = gl.getActiveAttrib(this.id, i);\r\n            const name = attribute.name;\r\n\r\n            this.a[name] = {\r\n                VBO: null,\r\n                loc: gl.getAttribLocation(this.id, name),\r\n                size: attribute.size,\r\n                type: attribute.type,\r\n            };\r\n        }\r\n    }\r\n}\r\n\r\nexport { ShaderProgram as Shader };\r\n","import { GLResource } from \"./gl-resource\";\r\n\r\nenum Usage {\r\n    DYNAMIC,\r\n    STATIC,\r\n}\r\n\r\nclass VBO extends GLResource {\r\n    public static createQuad(gl: WebGLRenderingContext, minX: number, minY: number, maxX: number, maxY: number): VBO {\r\n        const vert = [\r\n            minX, minY,\r\n            maxX, minY,\r\n            minX, maxY,\r\n            maxX, maxY,\r\n        ];\r\n\r\n        return new VBO(gl, new Float32Array(vert), 2, gl.FLOAT, true);\r\n    }\r\n\r\n    private id: WebGLBuffer;\r\n    private size: number;\r\n    private type: GLenum;\r\n    private normalize: GLboolean;\r\n    private stride: GLsizei;\r\n    private offset: GLintptr;\r\n    private usage: Usage;\r\n\r\n    constructor(gl: WebGLRenderingContext, array: any, size: number, type: GLenum, staticUsage: boolean = true) {\r\n        super(gl);\r\n\r\n        this.id = gl.createBuffer();\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (staticUsage) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n\r\n        this.size = size;\r\n        this.type = type;\r\n        this.normalize = false;\r\n        this.stride = 0;\r\n        this.offset = 0;\r\n        this.usage = (staticUsage) ? Usage.STATIC : Usage.DYNAMIC;\r\n    }\r\n\r\n    public freeGLResources(): void {\r\n        this.gl().deleteBuffer(this.id);\r\n        this.id = null;\r\n    }\r\n\r\n    public bind(location: GLuint): void {\r\n        const gl = super.gl();\r\n        gl.enableVertexAttribArray(location);\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        gl.vertexAttribPointer(location, this.size, this.type, this.normalize, this.stride, this.offset);\r\n    }\r\n\r\n    public setData(array: any): void {\r\n        const gl = super.gl();\r\n\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.id);\r\n        if (this.usage === Usage.STATIC) {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.STATIC_DRAW);\r\n        } else {\r\n            gl.bufferData(gl.ARRAY_BUFFER, array, gl.DYNAMIC_DRAW);\r\n        }\r\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\r\n    }\r\n}\r\n\r\nexport { VBO };\r\n","class Viewport {\r\n    public static setFullCanvas(gl: WebGLRenderingContext): void {\r\n        gl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight);\r\n    }\r\n\r\n    public lower: number;\r\n    public left: number;\r\n    public width: number;\r\n    public height: number;\r\n\r\n    constructor(left: number, lower: number, width: number, height: number) {\r\n        this.left = left;\r\n        this.lower = lower;\r\n        this.width = width;\r\n        this.height = height;\r\n    }\r\n\r\n    public set(gl: WebGLRenderingContext): void {\r\n        gl.viewport(this.lower, this.left, this.width, this.height);\r\n    }\r\n}\r\n\r\nexport { Viewport };\r\n","import { gl } from \"./gl-utils/gl-canvas\";\r\n\r\nimport { EHeightmapMode, Parameters } from \"./parameters\";\r\nimport { Scene } from \"./scene\";\r\nimport { ITexture } from \"./texture/i-texture\";\r\nimport { ImageTexture } from \"./texture/image-texture\";\r\n\r\n\r\nclass Heightmap {\r\n    private readonly heightmapTexture: ImageTexture;\r\n\r\n    private readonly scene: Scene;\r\n\r\n    public constructor() {\r\n        this.heightmapTexture = new ImageTexture();\r\n\r\n        this.scene = new Scene();\r\n\r\n        Parameters.heightmapChangeObservers.push((image: HTMLImageElement) => {\r\n            this.heightmapTexture.uploadToGPU(image);\r\n        });\r\n    }\r\n\r\n    public get current(): ITexture {\r\n        if (Parameters.heightmapMode === EHeightmapMode.MOVING) {\r\n            this.scene.computeDepthMap(gl.canvas.width, gl.canvas.height);\r\n            return this.scene.depthMap;\r\n        } else {\r\n            return this.heightmapTexture;\r\n        }\r\n    }\r\n}\r\n\r\nexport {\r\n    Heightmap,\r\n};\r\n\r\n","import \"./page-interface-generated\";\r\n\r\n\r\nconst loadingObjects: { [id: string]: boolean } = {};\r\n\r\nfunction registerLoadingObject(id: string): void {\r\n    if (Object.keys(loadingObjects).length === 0) {\r\n        Page.Canvas.showLoader(true);\r\n    }\r\n    loadingObjects[id] = false;\r\n}\r\n\r\nfunction registerLoadedObject(id: string): void {\r\n    delete loadingObjects[id];\r\n\r\n    if (Object.keys(loadingObjects).length === 0) {\r\n        Page.Canvas.showLoader(false);\r\n    }\r\n}\r\n\r\nexport {\r\n    registerLoadedObject,\r\n    registerLoadingObject,\r\n};\r\n\r\n","import * as GLCanvas from \"./gl-utils/gl-canvas\";\r\nimport { gl } from \"./gl-utils/gl-canvas\";\r\n\r\nimport { Engine } from \"./engine\";\r\nimport { Heightmap } from \"./heightmap\";\r\nimport { EHeightmapMode, ETileMode, Parameters } from \"./parameters\";\r\nimport { Tile } from \"./tile\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\n\r\nfunction main(): void {\r\n    const webglFlags = {\r\n        alpha: false,\r\n        antialias: false,\r\n        depth: false,\r\n        stencil: false,\r\n        preserveDrawingBuffer: false,\r\n    };\r\n    if (!GLCanvas.initGL(webglFlags)) {\r\n        return;\r\n    }\r\n    gl.disable(gl.CULL_FACE);\r\n    gl.disable(gl.BLEND);\r\n    gl.enable(gl.DEPTH_TEST);\r\n    gl.disable(gl.STENCIL_TEST);\r\n\r\n    const canvas = Page.Canvas.getCanvas();\r\n\r\n    const engine = new Engine();\r\n    const heightmap = new Heightmap();\r\n    const tile = new Tile();\r\n\r\n    let nbFramesSinceLastUpdate = 0;\r\n    setInterval(() => {\r\n        Page.Canvas.setIndicatorText(\"fps-indicator\", Math.round(nbFramesSinceLastUpdate).toFixed(0));\r\n        nbFramesSinceLastUpdate = 0;\r\n\r\n        const currentTile = tile.current.texture;\r\n        Page.Canvas.setIndicatorText(\"tilesize-indicator\", `${currentTile.width}x${currentTile.height}`);\r\n\r\n        Page.Canvas.setIndicatorText(\"stripes-count-indicator\", engine.stripesCount.toFixed(0));\r\n    }, 1000);\r\n\r\n    let needToDownload = false;\r\n    Parameters.imageDownloadObservers.push(() => { needToDownload = true; });\r\n\r\n    let needToRedraw = true;\r\n    Parameters.redrawObservers.push(() => { needToRedraw = true; });\r\n\r\n    let needToRecomputeNoiseTile = true;\r\n    Parameters.recomputeNoiseTileObservers.push(() => { needToRecomputeNoiseTile = true; });\r\n\r\n    function mainLoop(): void {\r\n        nbFramesSinceLastUpdate++;\r\n\r\n        if (needToDownload) {\r\n            // redraw before resizing the canvas because the download pane might open, which changes the canvas size\r\n            engine.draw(heightmap, tile); // redraw because preserveDrawingBuffer is false\r\n            download(canvas);\r\n            needToDownload = false;\r\n        }\r\n\r\n        if (Parameters.heightmapMode === EHeightmapMode.MOVING) {\r\n            needToRecomputeNoiseTile = true;\r\n            needToRedraw = true;\r\n        }\r\n\r\n        if (needToRecomputeNoiseTile && Parameters.tileMode === ETileMode.NOISE) {\r\n            const width = Parameters.noiseTileResolution;\r\n            const height = Parameters.noiseTileSquare ? width : 5 * width;\r\n            needToRecomputeNoiseTile = !tile.randomize(width, height);\r\n        }\r\n\r\n        if (needToRedraw) {\r\n            GLCanvas.adjustSize(true);\r\n            needToRedraw = !engine.draw(heightmap, tile);\r\n        }\r\n\r\n        requestAnimationFrame(mainLoop);\r\n    }\r\n    mainLoop();\r\n}\r\n\r\nfunction download(canvas: HTMLCanvasElement): void {\r\n    const name = \"stereogram.png\";\r\n\r\n    if ((canvas as any).msToBlob) { // for IE\r\n        const blob = (canvas as any).msToBlob();\r\n        (window.navigator as any).msSaveBlob(blob, name);\r\n    } else {\r\n        canvas.toBlob((blob: Blob) => {\r\n            const link = document.createElement(\"a\");\r\n            link.download = name;\r\n            link.href = URL.createObjectURL(blob);\r\n            link.click();\r\n        });\r\n    }\r\n}\r\n\r\nmain();\r\n","import { gl } from \"./gl-utils/gl-canvas\";\r\nimport { VBO } from \"./gl-utils/vbo\";\r\nimport * as Loader from \"./loader\";\r\n\r\n\r\ninterface IPoint {\r\n    x: number;\r\n    y: number;\r\n    z: number;\r\n}\r\n\r\nclass ObjModel {\r\n    public readonly trianglesCount: number;\r\n    public readonly data: Float32Array;\r\n    public readonly VBO: VBO;\r\n\r\n    public static parse(input: string): ObjModel {\r\n        const lines = input.split(\"\\n\");\r\n\r\n        const vertices: IPoint[] = [];\r\n        const geometry: number[] = [];\r\n\r\n        for (let i = 0; i < lines.length; i++) {\r\n            const line = lines[i].trim();\r\n            const lineItems = line.split(/\\s+/);\r\n            const command = lineItems[0];\r\n\r\n            if (command === \"v\") { // declare vertex\r\n                if (lineItems.length >= 4) {\r\n                    vertices.push({\r\n                        x: parseFloat(lineItems[1]),\r\n                        y: parseFloat(lineItems[2]),\r\n                        z: parseFloat(lineItems[3]),\r\n                    });\r\n                } else {\r\n                    console.log(`Ignoring line ${i} because it does not have enough items: '${line}'.`);\r\n                    continue;\r\n                }\r\n            } else if (command === \"f\") { // declare face\r\n                if (lineItems.length >= 4) {\r\n                    // faces with more that 3 vertices are interpreted as TRIANGLE_FAN\r\n                    for (let iV = 3; iV < lineItems.length; iV++) {\r\n                        const indices: number[] = [\r\n                            +(lineItems[1].split(\"/\")[0]),\r\n                            +(lineItems[iV - 1].split(\"/\")[0]),\r\n                            +(lineItems[iV].split(\"/\")[0]),\r\n                        ];\r\n\r\n                        for (const indice of indices) {\r\n                            if (indice < 1 || indice > vertices.length) {\r\n                                console.log(`Ignoring line ${i} because vertex index ${indice} is out of range: '${line}'.`);\r\n                                continue;\r\n                            }\r\n                        }\r\n\r\n                        geometry.push(vertices[indices[0] - 1].x);\r\n                        geometry.push(vertices[indices[0] - 1].y);\r\n                        geometry.push(vertices[indices[0] - 1].z);\r\n                        geometry.push(vertices[indices[1] - 1].x);\r\n                        geometry.push(vertices[indices[1] - 1].y);\r\n                        geometry.push(vertices[indices[1] - 1].z);\r\n                        geometry.push(vertices[indices[2] - 1].x);\r\n                        geometry.push(vertices[indices[2] - 1].y);\r\n                        geometry.push(vertices[indices[2] - 1].z);\r\n                    }\r\n                } else {\r\n                    console.log(`Ignoring line ${i} because only triangular faces are supported: '${line}'.`);\r\n                    continue;\r\n                }\r\n            } else {\r\n                console.log(`Ignoring line ${i}: '${line}'.`);\r\n                continue;\r\n            }\r\n        }\r\n\r\n        return new ObjModel(new Float32Array(geometry));\r\n    }\r\n\r\n    public constructor(data: Float32Array) {\r\n        if (data.length % 9 !== 0) {\r\n            throw new Error(`Invalid data: ${data.length}`);\r\n        }\r\n\r\n        this.data = data;\r\n        this.trianglesCount = data.length / 9;\r\n\r\n        this.VBO = new VBO(gl, this.data, 3, gl.FLOAT, true);\r\n    }\r\n}\r\n\r\nconst modelsCache: { [name: string]: ObjModel } = {};\r\n\r\nfunction asyncLoadObjModel(name: string, callback: (model: ObjModel) => unknown): void {\r\n    if (typeof modelsCache[name] !== \"undefined\") {\r\n        callback(modelsCache[name]);\r\n    } else {\r\n        const id = `model-${name}`;\r\n        Loader.registerLoadingObject(id);\r\n\r\n        const request = new XMLHttpRequest();\r\n        request.addEventListener(\"load\", () => {\r\n            Loader.registerLoadedObject(id);\r\n\r\n            if (request.status === 200) {\r\n                if (typeof modelsCache[name] === \"undefined\") { // maybe it was loaded in the meantime\r\n                    modelsCache[name] = ObjModel.parse(request.responseText);\r\n                }\r\n            }\r\n\r\n            callback(modelsCache[name] ?? null);\r\n        });\r\n        request.open(\"GET\", `resources/models/${name}?v=${Page.version}`);\r\n        request.send();\r\n    }\r\n}\r\n\r\nexport {\r\n    asyncLoadObjModel,\r\n    ObjModel,\r\n};\r\n\r\n","import * as Loader from \"./loader\";\r\n\r\nimport \"./page-interface-generated\";\r\n\r\n\r\n/* === IDs ============================================================ */\r\nconst controlId = {\r\n    TILE_MODE_TABS: \"tile-mode-tabs-id\",\r\n    TILE_PRESET_SELECT: \"tile-preset-select-id\",\r\n    TILE_NOISE_RESOLUTION: \"tile-noise-resolution-range-id\",\r\n    TILE_NOISE_SQUARE: \"tile-noise-square-checkbox-id\",\r\n    TILE_NOISE_COLORED: \"tile-noise-colored-checkbox-id\",\r\n    SHOW_UV: \"show-uv-checkbox-id\",\r\n    TILE_UPLOAD_BUTTON: \"input-tile-upload-button\",\r\n\r\n    HEIGHTMAP_MODE_TABS: \"heightmap-mode-tabs-id\",\r\n    HEIGHTMAP_PRESET_SELECT: \"heightmap-preset-select-id\",\r\n    MODEL_PRESET_SELECT: \"model-preset-select-id\",\r\n    DEPTH_RANGE: \"depth-range-id\",\r\n    HEIGHTMAP_INVERT_CHECKBOX: \"invert-heightmap-checkbox-id\",\r\n    SHOW_HEIGHTMAP: \"show-heightmap-checkbox-id\",\r\n    HEIGHTMAP_UPLOAD_BUTTON: \"input-heightmap-upload-button\",\r\n\r\n    STRIPES_MAIN_TABS: \"main-stripe-tabs-id\",\r\n    STRIPES_MODE_TABS: \"stripes-mode-tabs-id\",\r\n    STRIPES_WIDTH_RANGE: \"stripes-width-range-id\",\r\n    STRIPES_COUNT_RANGE: \"stripes-count-range-id\",\r\n\r\n    SHOW_INDICATORS_CHECKBOX: \"show-indicators-checkbox-id\",\r\n    IMAGE_DOWNLOAD: \"image-download-id\",\r\n};\r\n\r\ntype Observer = () => unknown;\r\ntype ImageUploadObserver = (image: HTMLImageElement) => unknown;\r\n\r\nfunction callObservers(observers: Observer[]): void {\r\n    for (const observer of observers) {\r\n        observer();\r\n    }\r\n}\r\n\r\nfunction callRedrawObservers(): void {\r\n    callObservers(Parameters.redrawObservers);\r\n}\r\n\r\nfunction callRecomputeNoiseTileObservers(): void {\r\n    callObservers(Parameters.recomputeNoiseTileObservers);\r\n    callRedrawObservers();\r\n}\r\n\r\nenum ETileMode {\r\n    TEXTURE = \"texture\",\r\n    NOISE = \"noise\",\r\n}\r\n\r\nenum EHeightmapMode {\r\n    STILL = \"still\",\r\n    MOVING = \"moving\",\r\n}\r\n\r\nenum EMainStripe {\r\n    LEFT = \"left\",\r\n    MIDDLE = \"middle\",\r\n}\r\n\r\nenum EStripesMode {\r\n    ADAPTATIVE = \"adaptative\",\r\n    FIXED = \"fixed\",\r\n}\r\n\r\nabstract class Parameters {\r\n    public static readonly tileChangeObservers: ImageUploadObserver[] = [];\r\n    public static readonly heightmapChangeObservers: ImageUploadObserver[] = [];\r\n\r\n    public static readonly redrawObservers: Observer[] = [];\r\n    public static readonly recomputeNoiseTileObservers: Observer[] = [];\r\n\r\n    public static readonly imageDownloadObservers: Observer[] = [];\r\n\r\n    public static get tileMode(): ETileMode {\r\n        return Page.Tabs.getValues(controlId.TILE_MODE_TABS)[0] as ETileMode;\r\n    }\r\n    public static get noiseTileResolution(): number {\r\n        return Page.Range.getValue(controlId.TILE_NOISE_RESOLUTION);\r\n    }\r\n    public static get noiseTileSquare(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.TILE_NOISE_SQUARE);\r\n    }\r\n    public static get noiseTileColored(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.TILE_NOISE_COLORED);\r\n    }\r\n    public static get showUV(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.SHOW_UV);\r\n    }\r\n\r\n    public static get heightmapMode(): EHeightmapMode {\r\n        return Page.Tabs.getValues(controlId.HEIGHTMAP_MODE_TABS)[0] as EHeightmapMode;\r\n    }\r\n    public static get modelId(): string {\r\n        return Page.Select.getValue(controlId.MODEL_PRESET_SELECT);\r\n    }\r\n    public static get depth(): number {\r\n        return Page.Range.getValue(controlId.DEPTH_RANGE);\r\n    }\r\n    public static get invertHeightmap(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.HEIGHTMAP_INVERT_CHECKBOX);\r\n    }\r\n    public static get showHeightmap(): boolean {\r\n        return Page.Checkbox.isChecked(controlId.SHOW_HEIGHTMAP);\r\n    }\r\n\r\n    public static get mainStripe(): EMainStripe {\r\n        return Page.Tabs.getValues(controlId.STRIPES_MAIN_TABS)[0] as EMainStripe;\r\n    }\r\n    public static get stripesMode(): EStripesMode {\r\n        return Page.Tabs.getValues(controlId.STRIPES_MODE_TABS)[0] as EStripesMode;\r\n    }\r\n    public static get stripesCount(): number {\r\n        return Page.Range.getValue(controlId.STRIPES_COUNT_RANGE);\r\n    }\r\n    public static get stripesWidth(): number {\r\n        return Page.Range.getValue(controlId.STRIPES_WIDTH_RANGE);\r\n    }\r\n}\r\n\r\nfunction parseImageUpload(filesList: FileList, callback: (uploadedImage: HTMLImageElement) => unknown): void {\r\n    if (filesList.length === 1) {\r\n        const reader = new FileReader();\r\n        reader.onload = () => {\r\n            const image = new Image();\r\n            image.addEventListener(\"load\", () => {\r\n                callback(image);\r\n            });\r\n            image.src = reader.result as string;\r\n        };\r\n        reader.readAsDataURL(filesList[0]);\r\n    }\r\n}\r\n\r\nfunction loadImage(url: string, callback: (loadedImage: HTMLImageElement) => unknown): void {\r\n    url += `?v=${Page.version}`;\r\n\r\n    Loader.registerLoadingObject(url);\r\n\r\n    const image = new Image();\r\n    image.addEventListener(\"load\", () => {\r\n        Loader.registerLoadedObject(url);\r\n        callback(image);\r\n    });\r\n    image.src = url;\r\n}\r\n\r\nfunction updateControlsVisibility(): void {\r\n    const isTileNoiseMode = (Parameters.tileMode === ETileMode.NOISE);\r\n    Page.Controls.setVisibility(controlId.TILE_NOISE_RESOLUTION, isTileNoiseMode);\r\n    Page.Controls.setVisibility(controlId.TILE_NOISE_COLORED, isTileNoiseMode);\r\n    Page.Controls.setVisibility(controlId.TILE_NOISE_SQUARE, isTileNoiseMode);\r\n    Page.Controls.setVisibility(controlId.TILE_PRESET_SELECT, !isTileNoiseMode);\r\n    Page.Controls.setVisibility(controlId.TILE_UPLOAD_BUTTON, !isTileNoiseMode);\r\n\r\n    const isMovingMode = (Parameters.heightmapMode === EHeightmapMode.MOVING);\r\n    Page.Controls.setVisibility(controlId.HEIGHTMAP_PRESET_SELECT, !isMovingMode);\r\n    Page.Controls.setVisibility(controlId.HEIGHTMAP_UPLOAD_BUTTON, !isMovingMode);\r\n    Page.Controls.setVisibility(controlId.MODEL_PRESET_SELECT, isMovingMode);\r\n}\r\n\r\n\r\nPage.Canvas.Observers.canvasResize.push(callRedrawObservers);\r\nPage.Checkbox.addObserver(controlId.SHOW_HEIGHTMAP, callRedrawObservers);\r\nPage.Range.addObserver(controlId.DEPTH_RANGE, callRedrawObservers);\r\nPage.Checkbox.addObserver(controlId.HEIGHTMAP_INVERT_CHECKBOX, callRedrawObservers);\r\nPage.Tabs.addObserver(controlId.HEIGHTMAP_MODE_TABS, () => {\r\n    if (Parameters.heightmapMode === EHeightmapMode.MOVING) {\r\n        Page.Tabs.setValues(controlId.TILE_MODE_TABS, [ETileMode.NOISE]);\r\n        Page.Tabs.clearStoredState(controlId.TILE_MODE_TABS);\r\n    }\r\n\r\n    updateControlsVisibility();\r\n    callRedrawObservers();\r\n});\r\n{\r\n    const onNewHeightmapTexture = (onlyIfPresetIs: string | null, image: HTMLImageElement) => {\r\n        const preset = Page.Select.getValue(controlId.HEIGHTMAP_PRESET_SELECT);\r\n        if (preset === onlyIfPresetIs) { // this method is call asynchronously, so check that the current preset is still the same\r\n            for (const observer of Parameters.heightmapChangeObservers) {\r\n                observer(image);\r\n            }\r\n            callRedrawObservers();\r\n        }\r\n    };\r\n\r\n    Page.FileControl.addUploadObserver(controlId.HEIGHTMAP_UPLOAD_BUTTON, (filesList: FileList) => {\r\n        Page.Select.setValue(controlId.HEIGHTMAP_PRESET_SELECT, null);\r\n        parseImageUpload(filesList, onNewHeightmapTexture.bind(null, null));\r\n    });\r\n\r\n    const onHeightmapPresetChange = () => {\r\n        const preset = Page.Select.getValue(controlId.HEIGHTMAP_PRESET_SELECT);\r\n        if (preset) {\r\n            Page.FileControl.clearFileUpload(controlId.HEIGHTMAP_UPLOAD_BUTTON);\r\n            loadImage(`resources/heightmaps/${preset}`, onNewHeightmapTexture.bind(null, preset));\r\n        }\r\n    };\r\n    Page.Select.addObserver(controlId.HEIGHTMAP_PRESET_SELECT, onHeightmapPresetChange);\r\n    onHeightmapPresetChange();\r\n}\r\n\r\n\r\nPage.Checkbox.addObserver(controlId.SHOW_UV, callRedrawObservers);\r\nPage.Tabs.addObserver(controlId.TILE_MODE_TABS, () => {\r\n    updateControlsVisibility();\r\n    callRedrawObservers();\r\n});\r\n{\r\n    const onNewTileTexture = (onlyIfPresetIs: string | null, image: HTMLImageElement) => {\r\n        const preset = Page.Select.getValue(controlId.TILE_PRESET_SELECT);\r\n        if (preset === onlyIfPresetIs) { // this method is call asynchronously, so check that the current preset is still the same\r\n            for (const observer of Parameters.tileChangeObservers) {\r\n                observer(image);\r\n            }\r\n            callRedrawObservers();\r\n        }\r\n    };\r\n\r\n    Page.FileControl.addUploadObserver(controlId.TILE_UPLOAD_BUTTON, (filesList: FileList) => {\r\n        Page.Select.setValue(controlId.TILE_PRESET_SELECT, null);\r\n        parseImageUpload(filesList, onNewTileTexture.bind(null, null));\r\n    });\r\n\r\n    const onTilePresetChange = () => {\r\n        const preset = Page.Select.getValue(controlId.TILE_PRESET_SELECT);\r\n        if (preset) {\r\n            Page.FileControl.clearFileUpload(controlId.TILE_UPLOAD_BUTTON);\r\n            loadImage(`resources/tiles/${preset}`, onNewTileTexture.bind(null, preset));\r\n        }\r\n    };\r\n    Page.Select.addObserver(controlId.TILE_PRESET_SELECT, onTilePresetChange);\r\n    onTilePresetChange();\r\n}\r\nPage.Range.addObserver(controlId.TILE_NOISE_RESOLUTION, callRecomputeNoiseTileObservers);\r\nPage.Checkbox.addObserver(controlId.TILE_NOISE_SQUARE, callRecomputeNoiseTileObservers);\r\nPage.Checkbox.addObserver(controlId.TILE_NOISE_COLORED, callRecomputeNoiseTileObservers);\r\n\r\n\r\n{\r\n    const updateStripesControlsVisibility = () => {\r\n        const isAdaptativeMode = Parameters.stripesMode === EStripesMode.ADAPTATIVE;\r\n        Page.Controls.setVisibility(controlId.STRIPES_COUNT_RANGE, !isAdaptativeMode);\r\n        Page.Controls.setVisibility(controlId.STRIPES_WIDTH_RANGE, isAdaptativeMode);\r\n    };\r\n    const onStripesChange = () => {\r\n        updateStripesControlsVisibility();\r\n        callRedrawObservers();\r\n    };\r\n    Page.Tabs.addObserver(controlId.STRIPES_MAIN_TABS, onStripesChange);\r\n    Page.Tabs.addObserver(controlId.STRIPES_MODE_TABS, onStripesChange);\r\n    Page.Range.addObserver(controlId.STRIPES_COUNT_RANGE, onStripesChange);\r\n    Page.Range.addObserver(controlId.STRIPES_WIDTH_RANGE, onStripesChange);\r\n    updateStripesControlsVisibility();\r\n}\r\n\r\n\r\nPage.FileControl.addDownloadObserver(controlId.IMAGE_DOWNLOAD, () => {\r\n    callObservers(Parameters.imageDownloadObservers);\r\n});\r\n\r\n\r\nfunction updateIndicatorsVisibility(): void {\r\n    Page.Canvas.setIndicatorsVisibility(Page.Checkbox.isChecked(controlId.SHOW_INDICATORS_CHECKBOX));\r\n}\r\nPage.Checkbox.addObserver(controlId.SHOW_INDICATORS_CHECKBOX, updateIndicatorsVisibility);\r\nupdateIndicatorsVisibility();\r\n\r\nupdateControlsVisibility();\r\n\r\nexport {\r\n    EHeightmapMode,\r\n    EStripesMode,\r\n    EMainStripe,\r\n    ETileMode,\r\n    Parameters,\r\n};\r\n\r\n","import { gl } from \"./gl-utils/gl-canvas\";\r\nimport { Shader } from \"./gl-utils/shader\";\r\n\r\nimport { asyncLoadObjModel, ObjModel } from \"./obj-model\";\r\nimport { Parameters } from \"./parameters\";\r\nimport { RenderToTextureWithDepth } from \"./texture/render-to-texture-with-depth\";\r\nimport { asyncLoadShader } from \"./utils\";\r\n\r\n\r\ninterface IScenePreset {\r\n    modelName: string;\r\n    cameraPosition: [number, number, number];\r\n    nearPlane: number;\r\n    farPlane: number;\r\n    model?: ObjModel; // \"undefined\" if not loaded, null if loading, ObjModel if loaded\r\n}\r\n\r\nconst presets: { [id: string]: IScenePreset } = {\r\n    \"primitives\": {\r\n        modelName: \"primitives.obj\",\r\n        cameraPosition: [-1.3, 0, -0.54],\r\n        nearPlane: 0.6,\r\n        farPlane: 2.2,\r\n    },\r\n    \"cube\": {\r\n        modelName: \"cube.obj\",\r\n        cameraPosition: [-2, 0, -1],\r\n        nearPlane: 1.3,\r\n        farPlane: 3,\r\n    },\r\n    \"monkey\": {\r\n        modelName: \"monkey.obj\",\r\n        cameraPosition: [-1.3, 0, -0.5],\r\n        nearPlane: 0.7,\r\n        farPlane: 2,\r\n    },\r\n    \"bunny\": {\r\n        modelName: \"bunny.obj\",\r\n        cameraPosition: [-1.7, 0, -0.8],\r\n        nearPlane: 0.9,\r\n        farPlane: 2.3,\r\n    },\r\n    \"atomium\": {\r\n        modelName: \"atomium.obj\",\r\n        cameraPosition: [-2.5, 0, -0.6],\r\n        nearPlane: 1.5,\r\n        farPlane: 3.4,\r\n    }\r\n};\r\n\r\ndeclare const mat4: any;\r\n\r\nclass Scene {\r\n    private readonly _depthMap: RenderToTextureWithDepth;\r\n\r\n    private readonly modelMatrix: any;\r\n    private readonly viewMatrix: any;\r\n    private readonly projectionMatrix: any;\r\n    private readonly mvMatrix: any;\r\n    private readonly mvpMatrix: any;\r\n\r\n    private shader: Shader;\r\n\r\n    public constructor() {\r\n        this._depthMap = new RenderToTextureWithDepth();\r\n\r\n        this.modelMatrix = mat4.create();\r\n        this.viewMatrix = mat4.create();\r\n        this.projectionMatrix = mat4.create();\r\n        this.mvMatrix = mat4.create();\r\n        this.mvpMatrix = mat4.create();\r\n\r\n        asyncLoadShader(\"scene\", \"scene.vert\", \"scene.frag\", (shader: Shader) => {\r\n            shader.u[\"uMVPMatrix\"].value = this.mvpMatrix;\r\n            this.shader = shader;\r\n        });\r\n    }\r\n\r\n    public computeDepthMap(width: number, height: number): void {\r\n        if (this.shader) {\r\n            const modelPreset = presets[Parameters.modelId];\r\n\r\n            mat4.lookAt(this.viewMatrix, modelPreset.cameraPosition, [0, 0, 0], [0, 0, 1]);\r\n\r\n            mat4.fromRotation(this.modelMatrix, 0.0005 * performance.now(), [0, 0, 1]);\r\n            mat4.multiply(this.mvMatrix, this.viewMatrix, this.modelMatrix);\r\n\r\n            mat4.perspective(this.projectionMatrix, 45, width / height, modelPreset.nearPlane, modelPreset.farPlane);\r\n            mat4.multiply(this.mvpMatrix, this.projectionMatrix, this.mvMatrix);\r\n\r\n            this._depthMap.reserveSpace(width, height);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this._depthMap.framebuffer);\r\n            gl.viewport(0, 0, this._depthMap.width, this._depthMap.height);\r\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT); // tslint:disable-line:no-bitwise\r\n\r\n            if (typeof modelPreset.model === \"undefined\") {\r\n                modelPreset.model = null;\r\n                const loadedModelId = Parameters.modelId;\r\n                asyncLoadObjModel(modelPreset.modelName, (model: ObjModel) => {\r\n                    if (loadedModelId === Parameters.modelId) { // this method is called asynchronously, so check that this is still the model we want\r\n                        modelPreset.model = model;\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (modelPreset.model) {\r\n                const model = modelPreset.model;\r\n\r\n                this.shader.a[\"aVertice\"].VBO = model.VBO;\r\n                this.shader.use();\r\n                this.shader.bindUniformsAndAttributes();\r\n\r\n                gl.drawArrays(gl.TRIANGLES, 0, 3 * model.trianglesCount);\r\n            }\r\n        }\r\n    }\r\n\r\n    public get depthMap(): RenderToTextureWithDepth {\r\n        return this._depthMap;\r\n    }\r\n}\r\n\r\nexport {\r\n    Scene,\r\n};\r\n\r\n","import { Shader } from \"./gl-utils/shader\";\r\n\r\nimport { asyncLoadShader } from \"./utils\";\r\n\r\n\r\ntype IShaderCollection = { [stripesCount: number]: Shader | null };\r\n\r\nconst shadersCollection: IShaderCollection = {};\r\n\r\nfunction getShader(stripesCount: number): Shader | null {\r\n    if (shadersCollection[stripesCount]) {\r\n        return shadersCollection[stripesCount];\r\n    } else if (typeof shadersCollection[stripesCount] === \"undefined\") { // not loaded yet\r\n        shadersCollection[stripesCount] = null; // register it as \"loading\"\r\n\r\n        asyncLoadShader(\"stereomap\", \"fullscreen.vert\", \"stereogram.frag\", (loadedShader: Shader) => {\r\n            shadersCollection[stripesCount] = loadedShader;\r\n        }, {\r\n            STRIPES_COUNT: stripesCount.toFixed(1),\r\n            LOOP_SIZE: Math.ceil(2 * stripesCount).toFixed(0),\r\n        });\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport {\r\n    getShader,\r\n};\r\n\r\n","import { gl } from \"../gl-utils/gl-canvas\";\r\n\r\nimport { createImageData } from \"../utils\";\r\nimport { ITexture } from \"./i-texture\";\r\n\r\n\r\nconst defaultImageData = createImageData(1, 1, new Uint8ClampedArray([0, 0, 0, 0]));\r\n\r\nclass ImageTexture implements ITexture {\r\n    public readonly id: WebGLTexture;\r\n\r\n    private _width: number = -1;\r\n    private _height: number = -1;\r\n\r\n    public constructor() {\r\n        this.id = gl.createTexture();\r\n\r\n        this.uploadToGPU(defaultImageData);\r\n    }\r\n\r\n    public uploadToGPU(image: HTMLImageElement | ImageData): void {\r\n        this._width = image.width;\r\n        this._height = image.height;\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, this.id);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n}\r\n\r\nexport {\r\n    ImageTexture,\r\n};\r\n\r\n","import { gl } from \"../gl-utils/gl-canvas\";\r\n\r\nimport { RenderToTexture } from \"./render-to-texture\";\r\n\r\nimport \"../page-interface-generated\";\r\n\r\n\r\nclass RenderToTextureWithDepth extends RenderToTexture {\r\n    private readonly depthTexture: WebGLTexture;\r\n\r\n    public constructor() {\r\n        super();\r\n\r\n        const extension = gl.getExtension(\"WEBGL_depth_texture\");\r\n        if (extension) {\r\n            this.depthTexture = gl.createTexture();\r\n        } else {\r\n            Page.Demopage.setErrorMessage(\"WEBGL_depth_texture-unavailable\", \"WebGL extension 'WEBGL_depth_texture' is not available.\");\r\n        }\r\n    }\r\n\r\n    protected reserveSpaceInternal(): void {\r\n        super.reserveSpaceInternal();\r\n\r\n        if (this.depthTexture) {\r\n            gl.bindTexture(gl.TEXTURE_2D, this.depthTexture);\r\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.DEPTH_COMPONENT, this.width, this.height, 0, gl.DEPTH_COMPONENT, gl.UNSIGNED_SHORT, null);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n            gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n            gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.TEXTURE_2D, this.depthTexture, 0);\r\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n        }\r\n    }\r\n}\r\n\r\nexport {\r\n    RenderToTextureWithDepth,\r\n};\r\n\r\n","import { gl } from \"../gl-utils/gl-canvas\";\r\n\r\nimport { ITexture } from \"./i-texture\";\r\n\r\n\r\nclass RenderToTexture implements ITexture {\r\n    public readonly texture: WebGLTexture;\r\n    public readonly framebuffer: WebGLFramebuffer;\r\n\r\n    private _width: number;\r\n    private _height: number;\r\n\r\n    public constructor() {\r\n        this.texture = gl.createTexture();\r\n        this.framebuffer = gl.createFramebuffer();\r\n        this._width = -1;\r\n        this._height = -1;\r\n    }\r\n\r\n    public reserveSpace(wantedWidth: number, wantedHeight: number): void {\r\n        wantedWidth = Math.ceil(wantedWidth);\r\n        wantedHeight = Math.ceil(wantedHeight);\r\n\r\n        if (this.width !== wantedWidth || this.height !== wantedHeight) {\r\n            this._width = wantedWidth;\r\n            this._height = wantedHeight;\r\n            this.reserveSpaceInternal();\r\n        }\r\n    }\r\n\r\n    public get width(): number {\r\n        return this._width;\r\n    }\r\n\r\n    public get height(): number {\r\n        return this._height;\r\n    }\r\n\r\n    public get id(): WebGLTexture {\r\n        return this.texture;\r\n    }\r\n\r\n    protected reserveSpaceInternal(): void {\r\n        gl.bindTexture(gl.TEXTURE_2D, this.texture);\r\n\r\n        const format = gl.RGBA;\r\n        gl.texImage2D(gl.TEXTURE_2D, 0, format, this._width, this._height, 0, format, gl.UNSIGNED_BYTE, null);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this.framebuffer);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, this.texture, 0);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        gl.bindTexture(gl.TEXTURE_2D, null);\r\n    }\r\n}\r\n\r\nexport {\r\n    RenderToTexture,\r\n};\r\n\r\n","import { ETileMode, Parameters } from \"./parameters\";\r\nimport { ImageTexture } from \"./texture/image-texture\";\r\nimport { createImageData } from \"./utils\";\r\n\r\n\r\ninterface ITileTexture {\r\n    texture: ImageTexture;\r\n    padding: number;\r\n}\r\n\r\nclass Tile {\r\n    private readonly tileTexture: ImageTexture;\r\n\r\n    private readonly randomTexture: ImageTexture;\r\n\r\n    public constructor() {\r\n        this.tileTexture = new ImageTexture();\r\n\r\n        Parameters.tileChangeObservers.push((image: HTMLImageElement) => {\r\n            this.tileTexture.uploadToGPU(image);\r\n        });\r\n\r\n        this.randomTexture = new ImageTexture();\r\n    }\r\n\r\n    public get current(): ITileTexture {\r\n        if (Parameters.tileMode === ETileMode.TEXTURE) {\r\n            return {\r\n                texture: this.tileTexture,\r\n                padding: 0,\r\n            };\r\n        } else {\r\n            return {\r\n                texture: this.randomTexture,\r\n                padding: 1,\r\n            };\r\n        }\r\n    }\r\n\r\n    public randomize(width: number, height: number): boolean {\r\n        const usefulWidth = width;\r\n        const usefulHeight = height;\r\n        width += 2; // add padding for seamless linear interpolation\r\n        height += 2;\r\n\r\n        const data = new Uint8ClampedArray(width * height * 4);\r\n\r\n        function computePaddingTexel(x: number, y: number): void {\r\n            const originalX = (((x - 1) + usefulWidth) % usefulWidth) + 1;\r\n            const originalY = (((y - 1) + usefulHeight) % usefulHeight) + 1;\r\n            const targetTexelStart = 4 * (x + width * y);\r\n            const originalTexelStart = 4 * (originalX + width * originalY);\r\n            for (let i = 0; i < 4; i++) {\r\n                data[targetTexelStart + i] = data[originalTexelStart + i];\r\n            }\r\n        }\r\n\r\n        // compute actual texture\r\n        for (let iY = 1; iY < height - 1; iY++) {\r\n            for (let iX = 1; iX < width - 1; iX++) {\r\n                const texelStart = 4 * (iX + width * iY);\r\n                data[texelStart + 0] = Math.floor(255.9 * Math.random());\r\n                data[texelStart + 1] = Math.floor(255.9 * Math.random());\r\n                data[texelStart + 2] = Math.floor(255.9 * Math.random());\r\n                data[texelStart + 3] = 255;\r\n            }\r\n        }\r\n\r\n        // add padding\r\n        for (let iX = 0; iX < width; iX++) {\r\n            computePaddingTexel(iX, 0);\r\n            computePaddingTexel(iX, height - 1);\r\n        }\r\n\r\n        for (let iY = 0; iY < height; iY++) {\r\n            computePaddingTexel(0, iY);\r\n            computePaddingTexel(width - 1, iY);\r\n        }\r\n\r\n        const imageData = createImageData(width, height, data);\r\n        this.randomTexture.uploadToGPU(imageData);\r\n        return true;\r\n    }\r\n}\r\n\r\nexport {\r\n    Tile,\r\n};\r\n\r\n","import { Shader } from \"./gl-utils/shader\";\r\nimport * as ShaderManager from \"./gl-utils/shader-manager\";\r\n\r\nimport * as Loader from \"./loader\";\r\n\r\n\r\nfunction asyncLoadShader(name: string, vertexFilename: string, fragmentFilename: string, callback: (shader: Shader) => unknown, injected: any = {}): void {\r\n    const id = `shader-${name}`;\r\n    Loader.registerLoadingObject(id);\r\n\r\n    ShaderManager.buildShader({\r\n        fragmentFilename,\r\n        vertexFilename,\r\n        injected,\r\n    }, (builtShader: Shader | null) => {\r\n        Loader.registerLoadedObject(id);\r\n\r\n        if (builtShader !== null) {\r\n            callback(builtShader);\r\n        } else {\r\n            Page.Demopage.setErrorMessage(`${name}-shader-error`, `Failed to build '${name}' shader.`);\r\n        }\r\n    });\r\n}\r\n\r\nlet hiddenCanvas: HTMLCanvasElement;\r\nlet hiddenCanvasContext: CanvasRenderingContext2D;\r\n\r\nfunction createImageData(width: number, height: number, data: Uint8ClampedArray): ImageData {\r\n    if (data.length !== width * height * 4) {\r\n        throw new Error(`Incoherent image data: width=${width} height=${height} data.length=${data.length}`);\r\n    }\r\n\r\n    try {\r\n        return new ImageData(data, width, height);\r\n    } catch {\r\n        console.log(\"Failed to create default ImageData from constructor, using Canvas2D instead...\");\r\n\r\n        if (!hiddenCanvas) {\r\n            hiddenCanvas = document.createElement(\"canvas\");\r\n            hiddenCanvasContext = hiddenCanvas.getContext(\"2d\");\r\n        }\r\n\r\n        const result = hiddenCanvasContext.createImageData(width, height);\r\n        for (let i = 0; i < result.data.length; i++) {\r\n            result.data[i] = data[i];\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\nfunction clamp(min: number, max: number, x: number): number {\r\n    if (x < min) {\r\n        return min;\r\n    } else if (x > max) {\r\n        return max;\r\n    }\r\n    return x;\r\n}\r\n\r\nexport {\r\n    asyncLoadShader,\r\n    clamp,\r\n    createImageData,\r\n};\r\n\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(633);\n"],"names":["watermarkTexture","ImageTexture","this","fullscreenVBO","VBO","createQuad","gl","asyncLoadShader","shader","heightmapShader","watermarkShader","credImage","Image","uploadCred","uploadToGPU","addEventListener","src","draw","heightmap","tile","currentTile","current","heightmapTexture","stripesCount","computeIdealStripeCount","usefulStripesProportion","heightmapHScaling","Parameters","showHeightmap","StereogramShader","getShader","tileUsefulWidth","texture","width","padding","tileUsefulHeight","height","tileHeight","canvasWidth","canvasHeight","u","value","id","tileMode","ETileMode","NOISE","noiseTileColored","showUV","mainStripe","EMainStripe","LEFT","Math","floor","drewStereogram","bindFramebuffer","FRAMEBUFFER","Viewport","setFullCanvas","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","a","invertHeightmap","depth","canvasAspectRatio","heightmapAspectRatio","use","bindUniformsAndAttributes","drawArrays","TRIANGLE_STRIP","drewWatermark","watermarkWidth","window","devicePixelRatio","watermarkHeight","left","max","canvas","viewport","stripesMode","EStripesMode","ADAPTATIVE","idealCount","round","stripesWidth","clamp","Engine","MIN_STRIPES_COUNT","MAX_STRIPES_COUNT","initGL","flags","setError","message","Page","Demopage","setErrorMessage","Canvas","getCanvas","getContext","disable","CULL_FACE","DEPTH_TEST","BLEND","clearColor","adjustSize","hidpi","cssPixel","clientWidth","clientHeight","_gl","GLResource","cachedShaders","buildShader","infos","callback","sourcesPending","sourcesFailed","loadedSource","success","processSource","source","replace","match","name","injected","vert","ShaderSources","getSource","vertexFilename","frag","fragmentFilename","processedVert","processedFrag","Shader","loadSource","registerShader","callAndClearCallbacks","cached","callbacks","cachedCallback","failed","pending","builtShader","push","deleteShader","freeGLResources","cachedSources","filename","text","url","version","XMLHttpRequest","open","onload","readyState","status","responseText","console","error","statusText","onerror","send","notImplemented","alert","types","str","binder","location","uniform2fv","uniform3fv","uniform4fv","uniform2iv","uniform3iv","uniform4iv","uniform1i","uniformMatrix2fv","uniformMatrix3fv","uniformMatrix4fv","unitNb","activeTexture","bindTexture","TEXTURE_2D","TEXTURE_CUBE_MAP","Array","isArray","uniform1iv","uniform1fv","uniform1f","vertexSource","fragmentSource","createShader","type","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","log","uCount","aCount","vertexShader","VERTEX_SHADER","fragmentShader","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","introspection","getProgramInfoLog","deleteProgram","useProgram","bindUniforms","currTextureUnitNb","Object","keys","forEach","uName","uniform","loc","bindAttributes","aName","attribute","bind","ACTIVE_UNIFORMS","i","getActiveUniform","getUniformLocation","size","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","Usage","array","staticUsage","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","DYNAMIC_DRAW","normalize","stride","offset","usage","STATIC","DYNAMIC","minX","minY","maxX","maxY","Float32Array","FLOAT","deleteBuffer","enableVertexAttribArray","vertexAttribPointer","setData","lower","drawingBufferWidth","drawingBufferHeight","set","scene","Scene","heightmapChangeObservers","image","heightmapMode","EHeightmapMode","MOVING","computeDepthMap","depthMap","Heightmap","loadingObjects","registerLoadingObject","length","showLoader","registerLoadedObject","GLCanvas","alpha","antialias","stencil","preserveDrawingBuffer","enable","STENCIL_TEST","engine","Tile","nbFramesSinceLastUpdate","setInterval","setIndicatorText","toFixed","needToDownload","imageDownloadObservers","needToRedraw","redrawObservers","needToRecomputeNoiseTile","recomputeNoiseTileObservers","mainLoop","msToBlob","blob","navigator","msSaveBlob","toBlob","link","document","createElement","download","href","URL","createObjectURL","click","noiseTileResolution","noiseTileSquare","randomize","requestAnimationFrame","main","data","Error","trianglesCount","parse","input","lines","split","vertices","geometry","line","trim","lineItems","command","x","parseFloat","y","z","iV","indices","indice","ObjModel","modelsCache","asyncLoadObjModel","Loader","controlId","callObservers","observers","observer","callRedrawObservers","callRecomputeNoiseTileObservers","Tabs","getValues","Range","getValue","Checkbox","isChecked","Select","tileChangeObservers","parseImageUpload","filesList","FileReader","result","readAsDataURL","loadImage","updateControlsVisibility","isTileNoiseMode","Controls","setVisibility","isMovingMode","Observers","canvasResize","addObserver","setValues","clearStoredState","onlyIfPresetIs","FileControl","addUploadObserver","setValue","onHeightmapPresetChange","preset","clearFileUpload","onTilePresetChange","isAdaptativeMode","onStripesChange","updateIndicatorsVisibility","setIndicatorsVisibility","addDownloadObserver","presets","modelName","cameraPosition","nearPlane","farPlane","_depthMap","RenderToTextureWithDepth","modelMatrix","mat4","create","viewMatrix","projectionMatrix","mvMatrix","mvpMatrix","modelId","lookAt","fromRotation","performance","now","multiply","perspective","reserveSpace","framebuffer","model","TRIANGLES","shadersCollection","loadedShader","STRIPES_COUNT","LOOP_SIZE","ceil","defaultImageData","createImageData","Uint8ClampedArray","_width","_height","createTexture","texParameteri","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","texImage2D","RGBA","UNSIGNED_BYTE","getExtension","depthTexture","reserveSpaceInternal","DEPTH_COMPONENT","UNSIGNED_SHORT","NEAREST","framebufferTexture2D","DEPTH_ATTACHMENT","RenderToTexture","createFramebuffer","wantedWidth","wantedHeight","format","COLOR_ATTACHMENT0","tileTexture","randomTexture","TEXTURE","usefulWidth","usefulHeight","computePaddingTexel","targetTexelStart","originalTexelStart","iY","iX","texelStart","random","imageData","hiddenCanvas","hiddenCanvasContext","ShaderManager","ImageData","min","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","call"],"sourceRoot":""}